<style>
/*
                   .canvas grid 10 and #photo-link image is at z-index of 5
                */

.loader {
    width: 40px;
    height: 40px;
    position: absolute;
    z-index: 1;
    margin: auto;
    left: 0;
    right: 0;
    top: 190px
}

.loader span {
    position: absolute;
    bottom: -40px;
    width: 130px;
    margin-left: -40px;
}

.loader .loader-circle {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
}

.loader .loader-circle:before {
    content: '';
    display: block;
    margin: 0 auto;
    width: 15%;
    height: 15%;
    background-color: #333;
    border-radius: 100%;
    -webkit-animation: loader-circleFadeDelay 1.2s infinite ease-in-out both;
    animation: loader-circleFadeDelay 1.2s infinite ease-in-out both;
}

.loader .loader-circle2 {
    -webkit-transform: rotate(30deg);
    -ms-transform: rotate(30deg);
    transform: rotate(30deg);
}

.loader .loader-circle3 {
    -webkit-transform: rotate(60deg);
    -ms-transform: rotate(60deg);
    transform: rotate(60deg);
}

.loader .loader-circle4 {
    -webkit-transform: rotate(90deg);
    -ms-transform: rotate(90deg);
    transform: rotate(90deg);
}

.loader .loader-circle5 {
    -webkit-transform: rotate(120deg);
    -ms-transform: rotate(120deg);
    transform: rotate(120deg);
}

.loader .loader-circle6 {
    -webkit-transform: rotate(150deg);
    -ms-transform: rotate(150deg);
    transform: rotate(150deg);
}

.loader .loader-circle7 {
    -webkit-transform: rotate(180deg);
    -ms-transform: rotate(180deg);
    transform: rotate(180deg);
}

.loader .loader-circle8 {
    -webkit-transform: rotate(210deg);
    -ms-transform: rotate(210deg);
    transform: rotate(210deg);
}

.loader .loader-circle9 {
    -webkit-transform: rotate(240deg);
    -ms-transform: rotate(240deg);
    transform: rotate(240deg);
}

.loader .loader-circle10 {
    -webkit-transform: rotate(270deg);
    -ms-transform: rotate(270deg);
    transform: rotate(270deg);
}

.loader .loader-circle11 {
    -webkit-transform: rotate(300deg);
    -ms-transform: rotate(300deg);
    transform: rotate(300deg);
}

.loader .loader-circle12 {
    -webkit-transform: rotate(330deg);
    -ms-transform: rotate(330deg);
    transform: rotate(330deg);
}

.loader .loader-circle2:before {
    -webkit-animation-delay: -1.1s;
    animation-delay: -1.1s;
}

.loader .loader-circle3:before {
    -webkit-animation-delay: -1s;
    animation-delay: -1s;
}

.loader .loader-circle4:before {
    -webkit-animation-delay: -0.9s;
    animation-delay: -0.9s;
}

.loader .loader-circle5:before {
    -webkit-animation-delay: -0.8s;
    animation-delay: -0.8s;
}

.loader .loader-circle6:before {
    -webkit-animation-delay: -0.7s;
    animation-delay: -0.7s;
}

.loader .loader-circle7:before {
    -webkit-animation-delay: -0.6s;
    animation-delay: -0.6s;
}

.loader .loader-circle8:before {
    -webkit-animation-delay: -0.5s;
    animation-delay: -0.5s;
}

.loader .loader-circle9:before {
    -webkit-animation-delay: -0.4s;
    animation-delay: -0.4s;
}

.loader .loader-circle10:before {
    -webkit-animation-delay: -0.3s;
    animation-delay: -0.3s;
}

.loader .loader-circle11:before {
    -webkit-animation-delay: -0.2s;
    animation-delay: -0.2s;
}

.loader .loader-circle12:before {
    -webkit-animation-delay: -0.1s;
    animation-delay: -0.1s;
}

@-webkit-keyframes loader-circleFadeDelay {
    0%,
    39%,
    100% {
        opacity: 0;
    }
    40% {
        opacity: 1;
    }
}

@keyframes loader-circleFadeDelay {
    0%,
    39%,
    100% {
        opacity: 0;
    }
    40% {
        opacity: 1;
    }
}


/*.canvas is at z-index of 10*/

#feedbackPhotoWrapper,
#photo-link {
    position: absolute;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 5;
    display: block;
    min-height: 460px;
}

.modal-backdrop {
    z-index: 1700 !important;
}

.grid-info {
    margin-bottom: 20px;
    overflow: auto;
    height: 460px;
}

.grid-info ol {
    margin-top: 20px;
}

.grid-info ol li {
    margin-bottom: 10px;
}

.zoomWindow {
    border: 0 !important;
}

h2 {
    line-height: 1.4;
}

.square {
    width: 30px;
    height: 30px;
    display: inline-block;
    vertical-align: middle;
}

.square-red {
    background-color: rgba(231, 76, 60, .8);
}

.square-green {
    background-color: rgba(0, 163, 136, .5);
}

#pathologistFeedback {
    margin-bottom: 0 !important;
}

main {
    position: relative;
}

.mechanic-content,
.feedback-content,
.grid-info {
    position: relative;
}

.legend {
    position: absolute;
    left: -198px;
    width: 200px;
    top: 47px;
    text-align: right;
}

.legend-item {
    display: inline-block;
    margin-right: 20px;
    margin-bottom: 20px;
}

.legend-item i {
    font-size: 30px;
    display: inline-block;
    color: black;
    vertical-align: middle;
}

.example-list {
    display: none;
    margin-bottom: 0 !important;
}

.grid-info-buttons {
    position: absolute;
    bottom: 20px;
    margin-top: 0;
    right: 20px;
    z-index: 2500;
}

.taskFeedback {
    display: none;
}

.slick-prev,
.slick-next {
    background-color: transparent;
    display: block;
    width: 40px !important;
    height: 40px !important;
    margin-top: -20px !important;
}

.slick-prev:before,
.slick-next:before {
    font-size: 40px;
    color: black;
    background-color: transparent;
}

.slick-prev,
.slick-next {
    background-color: transparent;
    display: block;
    width: 40px !important;
    height: 40px !important;
    margin-top: -20px !important;
}

.slick-prev:before,
.slick-next:before {
    font-size: 40px;
    color: black;
    background-color: transparent;
}

.slick-prev {
    left: -55px;
    width: 40px !important;
    height: 40px !important;
}

.slick-next {
    right: -55px;
    width: 40px !important;
    height: 40px !important;
}

.grid-info-content-inner {
    margin-bottom: 20px;
    border-bottom: 1px solid #999;
    padding-bottom: 10px;
}

.feedback-active .mechanic-active {
    display: none;
}

.mechanic-active .feedback-show {
    display: none;
}

.mechanic-active .modal #0 {
    display: none;
}

.zoomWindow {
    z-index: 2000 !important;
}
</style>
<!--MODAL-->
<div class="modals row">
    <div class="span12">

        <!-- Practice/Feedback Modal -->
        <div id="practiseModal" class="modal hide">
            <div id="0" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-16-annotated-cancer-area.jpg"
                         data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-16-annotated-cancer.jpg" alt="" />
                </div>
                <div id="annotatedImageZoomArea0" class="modal-info">
                    <h2>The <strong class="text-error">cancer cells</strong> have formed distinct <b>large</b> clusters at the top and bottom of this image.</h2>
                    <h2>
                        We’ve outlined them in <strong class="text-error">red</strong>.
                        Most cells are <b>blotchy</b>, quite <b>large</b> and their <b>shapes and sizes</b> are quite <b>different</b>
                    </h2>
                    <hr>
                    <h2>Everything else is <strong class="text-success">non-cancer cells</strong></h2>
                    <h2>They include:</h2>
                    <ul>
                        <li><b>Longer</b> and <b>thinner</b> blue stromal cells</li>
                        <li><b>Small blue or dark brown round</b> cells, which are blood cells</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>
            <div id="1" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-17-annotated-cancer-area.jpg"
                         data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-17-annotated-cancer.jpg" alt="" />
                </div>
                <div id="annotatedImageZoomArea1" class="modal-info">
                    <h2>Here, the <strong class="text-error">cancer cells</strong> cells have formed distinct <b>clusters</b>.</h2>
                    <h2>We’ve outlined them in <strong class="text-error">red</strong>.</h2>
                    <ul>
                        <li>They are <b>large</b> with <b>strange, blotchy patterns</b></li>
                        <li>No two <strong class="text-error">cancer cells</strong> look the same</li>
                    </ul>
                    <hr>
                    <h2>They are surrounded by a flood of <strong class="text-success">non-cancer cells</strong>, which include:</h2>
                    <ul>
                        <li><b>Small, blue round cells</b> and <b>dark brown spots</b> which are blood cells</li>
                        <li>Mixed with <b>light blue</b> and <b>wispy</b> stromal cells</li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>
            <div id="2" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-07-annotated-cancer-and-non.jpg"
                         data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-07-annotated-cancer-and-non-outline.jpg" alt="" />
                </div>
                <div id="annotatedImageZoomArea2" class="modal-info">
                    <h2>
                        Here, the <strong class="text-error">cancer cells</strong> are <b>large</b> and have formed <b>irregular clumps</b>.
                        We’ve marked them in <strong class="text-error">red</strong>.
                    </h2>
                    <h2>The clumps are surrounded by <strong class="text-success">non-cancer cells</strong> which include:</h2>
                    <ul>
                        <li><b>Small, round, dark blue</b> or <b>dark brown spots</b> of blood cells</li>
                        <li><b>Stretched looking wispy</b> stromal cells</li>
                    </ul>
                    <h2>We’ve outlined the strange structure in the centre of the image in <b class="text-success">green </b></h2>
                    <ul>
                        <li>These are red blood cells.</li>
                        <li>It will appear <b>grey</b>, with round <b> structures</b></li>
                        <li>If you see this in an image, mark it as <b class="text-success">non-cancer</b></li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>
            <div id="3" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/ki67-09.jpg"
                         data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-09.jpg" alt="" />
                </div>
                <div id="annotatedImageZoomArea3" class="modal-info">
                    <h1>This image is pretty much <b>all cancer cells!</b></h1>
                    <ul>
                        <li>The cells are <b>large, mottled</b> and <b>irregular</b></li>
                        <li>No two cancer cells look the same</li>
                        <li>They’ve formed an <b>unorganised, sprawling mass</b></li>
                    </ul>
                    <h3>Hover your mouse over the image to take a closer look.</h3>
                </div>
            </div>
            <div id="4" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-22-annotated-cancer-area.jpg"
                         data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-22-annotated-cancer.jpg" alt="" />
                </div>
                <div id="annotatedImageZoomArea4" class="modal-info">
                    <h2>The <b class="text-error">cancer</b> <b>cells</b> are outlined in <b class="text-error">red</b>. They’ve formed <b>clumps</b>. The cells are <b>large</b> and <b>irregular</b>.</h2>
                    <h2>Everything else is <b class="text-success">non-cancer</b> cells.  They include:</h2>
                    <ul>
                        <li><b>Small, round, dark blue</b> blood cells</li>
                        <li><b>Stretched-looking wispy</b> stromal cells</b></li>
                    </ul>
                    <h3>
                        Hover your mouse over the image to take a closer look.
                    </h3>
                </div>
            </div>
            <!-- FEEDBACK INFO -->
            <div id="5" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid.jpg" />
                </div>
                <div id="annotatedImageZoomArea5" class="modal-info">
                    <h1>
                        In the next set of practice images you need to mark the whole image and then we’ll let you know what our experts thought.

                    </h1>
                    <h2>
                        If you get something wrong look again in detail at that section and try to answer it again.
                    </h2>
                </div>
            </div>
            <!-- SUMMARY -->
            <div id="6" class="modal-body">
                <div class="modal-image">
                    <img class="annotatedImage" src="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/26-cancer.png" data-zoom-image="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/@2x-min/26-cancer-outline@2x-min.png" alt="" />
                </div>
                <div id="annotatedImageZoomArea6" class="modal-info">
                    <h1>
                        You are now about to <strong>start</strong> analysing cancer images.
                    </h1>
                    <ul>
                        <li>
                            You will be shown 10 images to analyse
                        </li>
                        <li>
                            You can stop and resume later if you want to
                        </li>
                        <li>
                            You can return to the tutorial at any time
                        </li>
                        <li>
                            The reference images at the bottom of the screen scroll to show examples of <strong class="text-error">cancer</strong> and <strong class="text-success">non-cancer cells</strong>
                        </li>
                        <li>
                            Don't worry if you're not sure, just give your best guess
                        </li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-right" id="backToPractiseBtn" data-dismiss="modal" aria-hidden="true">Continue</button>
                <button class="btn btn-primary" id="startMechanicBtn" data-dismiss="modal" aria-hidden="true" style="display: none;">
                    <i class="icon-thumbs-up"></i> Start
                </button>
            </div>
        </div>

        <!-- Tutoiral Modal -->
        <div id="tutorialModal" class="modal hide ">
            <div id="0" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-05.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        Welcome to Trailblazer!
                    </h1>
                    <h2>
                        We need your help identifying <strong class="text-error">cancer cells</strong>, distinguishing them from <strong class="text-success">non-cancer cells</strong> in images like the one to the left.
                    </h2>
                </div>
            </div>
            <div id="1" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/village.png" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        Non-cancer cells are strictly organised and controlled.
                    </h1>
                    <h2>
                        This is similar to the houses in this town. They’ve been carefully planned and built to strict guidelines, taking other houses in the area into consideration. Permission is needed to make any changes to this highly regulated town.
                    </h2>
                </div>
            </div>
            <!--<div id="2" class="modal-body" style="display:none">-->
                <!--<div class="modal-image">-->
                    <!--<img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/towns.png" alt="" />-->
                <!--</div>-->
                <!--<div class="modal-info">-->
                    <!--<h1>-->
                        <!--But, in cancer, cells become less tightly controlled.-->
                    <!--</h1>-->
                    <!--<h2>-->
                        <!--When cells become cancerous, they become less controlled. They replicate to make more cells wherever and however they can, with little consideration to rules or regulations. Our town is rapidly expanding, with buildings of all shapes and sizes sprouting up wherever they find space.-->
                    <!--</h2>-->
                <!--</div>-->
            <!--</div>-->
            <div id="2" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/city.png" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        In serious cases, cancer becomes a sprawling mass of disorganised cells, of <b>all</b> shapes and sizes.
                    </h1>
                    <h2>
                        Our town has grown into a crowded and varied city. With continued growth and lack of control, it starts to spread and take over neighbouring areas.
                    </h2>
                </div>
            </div>
            <!--WITH CAROUSEL-->
            <div id="3" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel3">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom3" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-05.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-05.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        Move your mouse over the image on the left to zoom in and see more detail.
                                    </h2>
                                    <h2>
                                        To identify <b>cancer cells</b>, look for
                                        <b>blotchy cells</b> grouped together in <b>uneven clumps</b>.
                                    </h2>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom3" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-05-annotated-cancer-area.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-05-annotated-cancer.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        We’ve highlighted the <b class="text-error">cancer cells</b> in
                                        <b class="text-error">red</b> in this image.
                                    </h2>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom3" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-05-annotated-healthy-area.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-05-annotated-healthy.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 1
                                    </h1>
                                    <h2>
                                        The remaining cells are <b class="text-success">non-cancer</b> and have been highlighted in
                                        <b class="text-success">green</b>. They include:
                                    </h2>
                                    <ol>
                                        <li><b>Blood cells</b>
                                            <ul>
                                                <li>These are <b>small, dark blue and round</b></li>
                                                <li>Sometimes they appear as <b>dark brown spots</b></li>
                                                <li>They can appear loosely spread out or in very dense clusters</li>
                                            </ul>
                                        </li>
                                        <li><b>Stromal cells</b>
                                            <ul>
                                                <li>These are often <b>light blue, wispy or stretched looking</b></li>
                                                <li>They often look like they are flowing or being stretched in a particular direction</li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList3"></div>
                        <!-- Carousel nav -->
                        <!--<a class="carousel-control left">&lsaquo;</a>-->
                        <!--<a class="carousel-control right">&rsaquo;</a>-->
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>
            <!--WITH CAROUSEL-->
            <div id="4" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel4">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom4" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 2
                                    </h1>
                                    <h2>
                                        You will often see <b>brown staining</b>. It appears when cells are dividing.
                                    </h2>
                                    <h2>
                                        <b>The staining will appear in <span class="text-error">cancer</span> and <span class="text-success">non-cancer</span></b> cells,
                                        so you can <b>ignore this</b> when deciding which cells are or are not cancerous.
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom4" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-04-annotated-cancer-non-cancer-area.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-04-annotated-cancer-non-cancer.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 2
                                    </h1>
                                    <h2>
                                        <span class="text-error">Cancer</span> cells divide a lot, so they are often brown.
                                        Some dividing cancer cells have been highlighted in <b class="text-error">red</b> in this image.
                                    </h2>
                                    <h2>
                                        But dividing <span class="text-success">non-cancer</span> cells can also appear brown.
                                        Examples of these are highlighted in <span class="text-success">green</span>
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <!--<div class="item">-->
                                <!--<img class="tutorialZoom5" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg"-->
                                     <!--data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg" alt="" />-->
                                <!--<div class="item-inner">-->
                                    <!--<h1>-->
                                        <!--Sample image 2-->
                                    <!--</h1>-->
                                    <!--<h2>-->
                                        <!--There are different types of-->
                                        <!--<strong>non-cancer cells</strong> in this image. The two most common types are:-->
                                    <!--</h2>-->
                                    <!--<ol>-->
                                        <!--<li><b>Blood cells</b>-->
                                            <!--<ul>-->
                                                <!--<li>These are <b>small, dark blue and round</b></li>-->
                                                <!--<li>Sometimes they appear as <b>dark brown spots</b></li>-->
                                                <!--<li>They can appear loosely spread out or in very dense clusters</li>-->
                                            <!--</ul>-->
                                        <!--</li>-->
                                        <!--<li><b>Stromal cells</b>-->
                                            <!--<ul>-->
                                                <!--<li>These are often <b>light blue, wispy or stretched looking</b></li>-->
                                                <!--<li>They often look like they are flowing or being stretched in a particular direction</li>-->
                                            <!--</ul>-->
                                        <!--</li>-->
                                    <!--</ol>-->
                                <!--</div>-->
                            <!--</div>-->
                            <!--<div class="item">-->
                                <!--<img class="tutorialZoom5" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg"-->
                                     <!--data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-04.jpg" alt="" />-->
                                <!--<div class="item-inner">-->
                                    <!--<h1>-->
                                        <!--Sample image 2-->
                                    <!--</h1>-->
                                    <!--<h2>-->
                                        <!--We've highlighted clusters of blood cells in <b class="text-success">green</b>-->
                                    <!--</h2>-->
                                    <!--<ul>-->
                                        <!--<li>These are <b>small, dark blue and round</b></li>-->
                                        <!--<li>Sometimes appear as <b>dark brown spots</b></li>-->
                                        <!--<li>They can appear loosely spread out or in very dense clusters</li>-->
                                    <!--</ul>-->
                                <!--</div>-->
                            <!--</div>-->
                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList4"></div>
                        <!-- Carousel nav -->
                        <!--<a class="carousel-control left">&lsaquo;</a>-->
                        <!--<a class="carousel-control right">&rsaquo;</a>-->
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>
            <div id="5" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div class="carousel slide" id="myCarousel5">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img class="tutorialZoom5" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-08.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-08.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 3
                                    </h1>
                                    <h2>
                                        Cancer cells can look very different from image to image. This time they are in <b>uneven</b> clumps.
                                    </h2>
                                    <h2>
                                        Have a look at the image on the left and see if you can identify the areas of cancer. Then click on 2 to see the answer.
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom5" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-08-annotated-cancer-area.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-08-annotated-cancer.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 3
                                    </h1>
                                    <h2>
                                        We've highlighted <span class="text-error">cancer</span> cells in <b class="text-error">red</b>  for this image.
                                        Here, they’re closely surrounded by a lot of <b class="text-success">non-cancer</b> <b>blood cells</b>.
                                    </h2>
                                    <h3>
                                        Move your mouse over the image to zoom in and see more detail.
                                    </h3>
                                </div>
                            </div>
                            <div class="item">
                                <img class="tutorialZoom5" src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-08-annotated-healthy-area.jpg"
                                     data-zoom-image="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/annotated/Ki67-08-annotated-healthy.jpg" alt="" />
                                <div class="item-inner">
                                    <h1>
                                        Sample image 3
                                    </h1>
                                    <h2>
                                        The remaining cells are <strong>non-cancer</strong> and have been highlighted in <b class="text-success">green</b>. They include:
                                    </h2>
                                    <ol>
                                        <li><b>Blood cells</b>
                                            <ul>
                                                <li>These are <b>small, dark blue and round</b></li>
                                                <li>Sometimes they appear as <b>dark brown spots</b></li>
                                                <li>They can appear loosely spread out or in very dense clusters</li>
                                            </ul>
                                        </li>
                                        <li><b>Stromal cells</b>
                                            <ul>
                                                <li>These are often <b>light blue, wispy or stretched looking</b></li>
                                                <li>They often look like they are flowing or being stretched in a particular direction</li>
                                            </ul>
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-indicators-custom" id="carouselIndicatorsList5"></div>
                        <!-- Carousel nav -->
                        <!--<a class="carousel-control left">&lsaquo;</a>-->
                        <!--<a class="carousel-control right">&rsaquo;</a>-->
                    </div>
                </div>
                <div class="modal-info"></div>
            </div>
            <div id="6" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        Let’s run through an example
                    </h1>
                    <h2>
                        We have split the images up into a 6x6 grid.
                    </h2>
                    <h2>
                        Some of the grid sections contain cancer cells and some of them do not.
                    </h2>
                    <h2>
                        We’re going to show you what to do.
                    </h2>
                </div>
            </div>
            <div id="7" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/tutorial-images/hover-over.png   " alt="" />
                </div>
                <div class="modal-info">
                    <h1>Look closely at the cells in each section</h1>
                    <h2>
                        You can zoom in to the image by moving the mouse over each section to get a closer look.
                        In a moment you’ll have a chance to try this for yourself.
                    </h2>
                    <h2>
                        There are a number of reference images at the bottom of the screen
                        showing examples of what <strong class="text-error">cancer</strong> and <strong class="text-success">non-cancer</strong> cells look like.
                    </h2>
                </div>
            </div>
            <div id="8" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        We’d like you to mark in <b class="text-error">red</b> any sections that contain cancer cells
                    </h1>
                    <h2>
                        Examine each section and if you think it contains cancer cells (even if you only see one or two cells)
                        <strong>click once to turn that section <b class="text-error">red</b></strong>.
                    </h2>
                </div>
            </div>
            <div id="9" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red-green.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        We’d like you to mark in <b class="text-success">green</b> any sections that do not contain cancer cells
                    </h1>
                    <h2>
                        Examine each section and if you think it <b>contains only <strong class="text-success">non-cancer cells</strong></b>,
                        you can <b>click</b> a second time to turn that section from <strong class="text-error">red</strong> to <strong class="text-success">green</strong>.
                    </h2>
                </div>
            </div>
            <div id="10" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red-green.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <h1>
                        Empty sections can be left blank
                    </h1>
                    <h2>
                        You can ignore any sections that are empty, normally corner and edge sections.
                    </h2>
                    <h2>
                        You can then click on the Next button to move to the next image
                    </h2>
                </div>
            </div>
            <div id="11" class="modal-body" style="display:none;">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid.jpg" alt="" />
                </div>
                <div class="modal-info">
                    <div id="tutorialSummary">
                        <h1>
                            We’ll now show you a few images that you can practise on.
                        </h1>
                        <h2>
                            We’ll let you know if our expert pathologists agreed with your analysis. There will also be information about each image, to help you understand what you are seeing.
                        </h2>
                        <h2>
                            For the first two images we’ll give you immediate feedback on your work.
                        </h2>
                    </div>
                    <div id="mechanicTutorialSummary" style="display:none;">
                        <h1>
                        You are now about to <strong>start</strong> analysing cancer images.
                    </h1>
                        <ul>
                            <li>
                                You will be shown 10 images to analyse
                            </li>
                            <li>
                                You can stop and resume later if you want to
                            </li>
                            <li>
                                You can return to the tutorial at any time
                            </li>
                            <li>
                                The reference images at the bottom of the screen scroll to show examples of <strong class="text-error">cancer</strong> and <strong class="text-success">non-cancer cells</strong>
                            </li>
                            <li>
                                Don't worry if you're not sure, just give your best guess
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn pull-left" id="closeMechanicTutorialBtn" data-dismiss="modal" aria-hidden="true" style="display:none;">Close</button>
                <a id="prevBtn" href="#" class="btn">Previous</a>
                <a id="nextBtn" href="#" class="btn btn-success">Next</a>
                <a class="btn btn-primary closeBtn" id="startFeedbackBtn" data-dismiss="modal" aria-hidden="true" style="display:none;"><i class="icon-thumbs-up"></i> Practice</a>
                <button class="btn btn-primary closeBtn pull-right " id="goBackBtn" type="button" data-dismiss="modal" aria-hidden="true" style="display:none;">Back to task</button>
            </div>
        </div>
    </div>
</div>
<header class="site-header clearfix">
    <div>
        <div id="loadingTask" class="alert alert-info" style="display:none;">
            <strong>Loading task...</strong>
        </div>
        <div id="success" class="alert alert-success" style="display:none">
            <h2><strong>Thanks!</strong> Your answer has been saved</h2>
        </div>
        <div id="loading" class="alert alert-info" style="display:none">
            <h2> Loading next task...</h2>
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none">
            <h2><strong>The task has been completed!</strong> Thanks a lot!</h2>
        </div>
        <div id="finish" class="alert alert-success" style="display:none">
            <h2><strong>Thank you</strong> for completing the analysis part of Trailblazer!</h2>
            <h2>The final step is to provide some feedback on using the system.</h2>
            <div class="alert-actions">
                <a class="btn small" href="http://citscitools.cancerresearchuk.org/community/mvp-04b-feedback/">Give feedback</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none">
            <h2><strong>Error!</strong> Something went wrong, please contact the site administrators</h2>
        </div>
        <div id="errorClick" class="alert alert-info" style="display:none; position: relative;">
            <i class="icon-remove" id="errorClickCross" style="position:absolute; right: 30px; cursor:pointer;"></i>
            <h2>If you are having problems clicking the grid, please refresh the page by clicking
                <b onclick="location.reload();" style="cursor:pointer;"><u>here</u></b></h2>
        </div>
    </div>
</header>
<main class="site-content clearfix">
    <!--LEGEND-->
    <div class="legend">
        <div class="legend-item">
            Cancer =
            <div class="square square-red"></div>
        </div>
        <div class="legend-item">
            Non-cancer =
            <div class="square square-green"></div>
        </div>
        <div class="legend-item feedback-show">
            Correct =
            <i class="icon-ok"></i>
        </div>
        <div class="legend-item feedback-show">
            Incorrect =
            <i class="icon-remove"></i>
        </div>
    </div>

    <!--MECHANIC-->
    <div class="mechanic-content" id="mechanicContent" style="display:none;">
        <div class="row-fluid">
            <div class="span12">
                <h1>Trailblazer - Task <span id="tasksCompleted"></span></h1>
            </div>
        </div>
        <div class="row-fluid clearfix">
            <!-- LEFT HAND SIDE-->
            <div class="span6 right wrapper grid-wrapper task-image-wrapper">
                <div class="loader">
                    <div class="loader-circle1 loader-circle"></div>
                    <div class="loader-circle2 loader-circle"></div>
                    <div class="loader-circle3 loader-circle"></div>
                    <div class="loader-circle4 loader-circle"></div>
                    <div class="loader-circle5 loader-circle"></div>
                    <div class="loader-circle6 loader-circle"></div>
                    <div class="loader-circle7 loader-circle"></div>
                    <div class="loader-circle8 loader-circle"></div>
                    <div class="loader-circle9 loader-circle"></div>
                    <div class="loader-circle10 loader-circle"></div>
                    <div class="loader-circle11 loader-circle"></div>
                    <div class="loader-circle12 loader-circle"></div>
                    <span>Loading task image...</span>
                </div>
                <a class="task-image-wrapper" id="photo-link"></a>
                <div class="canvas" id="mechanicCanvas"></div>
            </div>
            <!-- RIGHT HAND SIDE -->
            <div class="span6 grid-info" id="mechanicZoomWindowLocation">
                <div class="grid-info-content">
                    <h1>Select the grid sections that contain cancer cells</h1>
                    <h3>Click once to mark <strong>cancer</strong> cells in <span class="text-error">Red</span>
                    </h3>
                    <h3>Click again to mark <strong>non-cancer</strong> cells in
                        <span class="text-success">Green</span></h3>
                    <h3>Empty sections of the image can be left blank</h3>
                    <p class="imgId"></p>
                    <div class="progress progress-striped">
                        <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
                    </div>
                    <div class="grid-info-buttons">
                        <button class="btn btn-primary" id="showTutorialModalBtn">Tutorial</button>
                        <button class="btn btn-answer btn-success nextSlideBtn" id="nextSlideBtn" value="next" style="margin-left:10px;">Next slide</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FEEDBACK -->
    <div class="feedback-content" id="feedbackContent">
        <div class="row-fluid">
            <div class="span12">
                <h1>Practice image <span id="feedbackImageNumber">1</span> of 5</h1>
            </div>
        </div>
        <div class="row-fluid clearfix">
            <!-- LEFT HAND IMAGE  -->
            <div class="span6 grid-wrapper">
                <div class="loader">
                    <div class="loader-circle1 loader-circle"></div>
                    <div class="loader-circle2 loader-circle"></div>
                    <div class="loader-circle3 loader-circle"></div>
                    <div class="loader-circle4 loader-circle"></div>
                    <div class="loader-circle5 loader-circle"></div>
                    <div class="loader-circle6 loader-circle"></div>
                    <div class="loader-circle7 loader-circle"></div>
                    <div class="loader-circle8 loader-circle"></div>
                    <div class="loader-circle9 loader-circle"></div>
                    <div class="loader-circle10 loader-circle"></div>
                    <div class="loader-circle11 loader-circle"></div>
                    <div class="loader-circle12 loader-circle"></div>
                    <span>Loading task image...</span>
                </div>
                <a id="feedbackPhotoWrapper"></a>
                <div class="canvas" id="feedbackCanvas"></div>
            </div>
            <!-- RIGHT FEEDBACK INFO -->
            <div class="span6 grid-info" id="feedbackZoomWindowLocation">
                <div>
                    <h3>Click once to mark <b>cancer</b> cells in <b class="text-error">Red</b></h3>
                    <h3>Click again to mark <b>non-cancer</b> cells in <b class="text-success">Green</b></h3>
                    <h3>You can click a third time to mark a section as blank (empty)</h3>
                    <!--<h3>Empty sections of the image can be left <b>blank</b></h3>-->
                    <h3>You can change your answer as often as you want. Just click a section of the image to change your answer.</h3>
                    <h3>Remember to look at the reference images below for help. <b>Click</b> the arrows to scroll and see more.</h3>
                </div>
                <hr>
                <div id="feedbackProgressText"></div>
                <h3><b>Click 'What's in this image' button</b>, to see what our experts said before practising on another slide</h3>
                <div class="progress progress-success progress-striped" style="display:none;">
                    <div class="bar" id="feedbackProgress"></div>
                </div>
                <div class="grid-info-buttons clearfix">
                    <a class="btn btn-success disabled" id="checkMyWorkBtn" style="display:none;">
                        Check my work
                    </a>
                    <button class="btn btn-answer" id="feedbackInfoBtn" style="margin-left: 10px;">What's in this image</button>
                    <a class="btn disabled" id="nextFeedbackStep" style="margin-left: 10px;">
                        Next slide
                    </a>
                    <a class="btn disabled" id="finishFeedback" style="display:none; margin-left: 10px;">
                        Next
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- EXAMPLES -->
    <div class="row-fluid">
        <div class="example-list clearfix">
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-4.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-10.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-2.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-3.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-4.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-5.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-6.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-7.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-8.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/cancer-example-9.jpg" alt="" />
                <figcaption class="description cancer">Cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item last">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/non-cancer-example-1.jpg" alt="" />
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/non-cancer-example-2.jpg" alt="" />
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/non-cancer-example-3.jpg" alt="" />
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/non-cancer-example-4.jpg" alt="" />
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
            <figure class="example-list-item">
                <img src="//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/examples/non-cancer-example-5.jpg" alt="" />
                <figcaption class="description non-cancer">Non-cancer Cells</figcaption>
            </figure>
        </div>
    </div>
</main>
<script type="text/javascript" async="async">
var hasSeenGuidenceInfo = false;
var totalGridPercentage = "";

var project_short_name = "{{ project.short_name }}";
if (project_short_name === "")
    project_short_name = "mvp-04b";

var cookie_feedback_name = project_short_name + 'feedback';
var cookie_tutorial_name = project_short_name + 'tutorial';
/*
 This is the pathologist grid square data that we can check the user answers against
 */

var feedbackData = [{
    "info": {
        "imgNumber": "//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-16.jpg",
        "squares": [{
            "column": 0,
            "answer": null,
            "row": 0
        }, {
            "column": 1,
            "answer": null,
            "row": 0
        }, {
            "column": 2,
            "answer": true,
            "row": 0
        }, {
            "column": 3,
            "answer": true,
            "row": 0
        }, {
            "column": 4,
            "answer": true,
            "row": 0
        }, {
            "column": 5,
            "answer": null,
            "row": 0
        },

         {
            "column": 0,
            "answer": null,
            "row": 1
        }, {
            "column": 1,
            "answer": true,
            "row": 1
        }, {
            "column": 2,
            "answer": true,
            "row": 1
        }, {
            "column": 3,
            "answer": true,
            "row": 1
        }, {
            "column": 4,
            "answer": true,
            "row": 1
        }, {
            "column": 5,
            "answer": true,
            "row": 1
        },

        {
            "column": 0,
            "answer": null,
            "row": 2
        }, {
            "column": 1,
            "answer": false,
            "row": 2
        }, {
            "column": 2,
            "answer": true,
            "row": 2
        }, {
            "column": 3,
            "answer": true,
            "row": 2
        }, {
            "column": 4,
            "answer": false,
            "row": 2
        }, {
            "column": 5,
            "answer": false,
            "row": 2
        },

        {
            "column": 0,
            "answer": null,
            "row": 3
        }, {
            "column": 1,
            "answer": false,
            "row": 3
        }, {
            "column": 2,
            "answer": true,
            "row": 3
        }, {
            "column": 3,
            "answer": true,
            "row": 3
        }, {
            "column": 4,
            "answer": true,
            "row": 3
        }, {
            "column": 5,
            "answer": false,
            "row": 3
        },

        {
            "column": 0,
            "answer": null,
            "row": 4
        }, {
            "column": 1,
            "answer": false,
            "row": 4
        }, {
            "column": 2,
            "answer": true,
            "row": 4
        }, {
            "column": 3,
            "answer": true,
            "row": 4
        }, {
            "column": 4,
            "answer": true,
            "row": 4
        }, {
            "column": 5,
            "answer": true,
            "row": 4
        },

        {
            "column": 0,
            "answer": null,
            "row": 5
        }, {
            "column": 1,
            "answer": null,
            "row": 5
        }, {
            "column": 2,
            "answer": false,
            "row": 5
        }, {
            "column": 3,
            "answer": true,
            "row": 5
        }, {
            "column": 4,
            "answer": true,
            "row": 5
        }, {
            "column": 5,
            "answer": null,
            "row": 5
        }]
    }
}, {
    "info": {
        "imgNumber": "//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-17.jpg",
        "squares": [{
            "column": 0,
            "answer": null,
            "row": 0
        }, {
            "column": 1,
            "answer": false,
            "row": 0
        }, {
            "column": 2,
            "answer": true,
            "row": 0
        }, {
            "column": 3,
            "answer": true,
            "row": 0
        }, {
            "column": 4,
            "answer": false,
            "row": 0
        }, {
            "column": 5,
            "answer": null,
            "row": 0
        },

        {
            "column": 0,
            "answer": false,
            "row": 1
        }, {
            "column": 1,
            "answer": false,
            "row": 1
        }, {
            "column": 2,
            "answer": true,
            "row": 1
        }, {
            "column": 3,
            "answer": true,
            "row": 1
        }, {
            "column": 4,
            "answer": true,
            "row": 1
        }, {
            "column": 5,
            "answer": false,
            "row": 1
        },

        {
            "column": 0,
            "answer": true,
            "row": 2
        }, {
            "column": 1,
            "answer": true,
            "row": 2
        }, {
            "column": 2,
            "answer": true,
            "row": 2
        }, {
            "column": 3,
            "answer": true,
            "row": 2
        }, {
            "column": 4,
            "answer": true,
            "row": 2
        }, {
            "column": 5,
            "answer": false,
            "row": 2
        },

        {
            "column": 0,
            "answer": true,
            "row": 3
        }, {
            "column": 1,
            "answer": true,
            "row": 3
        }, {
            "column": 2,
            "answer": true,
            "row": 3
        }, {
            "column": 3,
            "answer": false,
            "row": 3
        }, {
            "column": 4,
            "answer": false,
            "row": 3
        }, {
            "column": 5,
            "answer": false,
            "row": 3
        },

        {
            "column": 0,
            "answer": false,
            "row": 4
        }, {
            "column": 1,
            "answer": false,
            "row": 4
        }, {
            "column": 2,
            "answer": true,
            "row": 4
        }, {
            "column": 3,
            "answer": true,
            "row": 4
        }, {
            "column": 4,
            "answer": false,
            "row": 4
        }, {
            "column": 5,
            "answer": false,
            "row": 4
        },

        {
            "column": 0,
            "answer": null,
            "row": 5
        }, {
            "column": 1,
            "answer": false,
            "row": 5
        }, {
            "column": 2,
            "answer": false,
            "row": 5
        }, {
            "column": 3,
            "answer": true,
            "row": 5
        }, {
            "column": 4,
            "answer": false,
            "row": 5
        }, {
            "column": 5,
            "answer": null,
            "row": 5
        }]
    }
}, {
    "info": {
        "imgNumber": "//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-07.jpg",
        "squares": [{
            "column": 0,
            "answer": null,
            "row": 0
        }, {
            "column": 1,
            "answer": null,
            "row": 0
        }, {
            "column": 2,
            "answer": false,
            "row": 0
        }, {
            "column": 3,
            "answer": true,
            "row": 0
        }, {
            "column": 4,
            "answer": false,
            "row": 0
        }, {
            "column": 5,
            "answer": null,
            "row": 0
        },

        {
            "column": 0,
            "answer": null,
            "row": 1
        }, {
            "column": 1,
            "answer": true,
            "row": 1
        }, {
            "column": 2,
            "answer": true,
            "row": 1
        }, {
            "column": 3,
            "answer": true,
            "row": 1
        }, {
            "column": 4,
            "answer": true,
            "row": 1
        }, {
            "column": 5,
            "answer": true,
            "row": 1
        },

        {
            "column": 0,
            "answer": false,
            "row": 2
        }, {
            "column": 1,
            "answer": true,
            "row": 2
        }, {
            "column": 2,
            "answer": false,
            "row": 2
        }, {
            "column": 3,
            "answer": false,
            "row": 2
        }, {
            "column": 4,
            "answer": true,
            "row": 2
        }, {
            "column": 5,
            "answer": true,
            "row": 2
        },

        {
            "column": 0,
            "answer": false,
            "row": 3
        }, {
            "column": 1,
            "answer": true,
            "row": 3
        }, {
            "column": 2,
            "answer": false,
            "row": 3
        }, {
            "column": 3,
            "answer": false,
            "row": 3
        }, {
            "column": 4,
            "answer": true,
            "row": 3
        }, {
            "column": 5,
            "answer": true,
            "row": 3
        },

        {
            "column": 0,
            "answer": null,
            "row": 4
        }, {
            "column": 1,
            "answer": false,
            "row": 4
        }, {
            "column": 2,
            "answer": false,
            "row": 4
        }, {
            "column": 3,
            "answer": false,
            "row": 4
        }, {
            "column": 4,
            "answer": false,
            "row": 4
        }, {
            "column": 5,
            "answer": true,
            "row": 4
        },

        {
            "column": 0,
            "answer": null,
            "row": 5
        }, {
            "column": 1,
            "answer": false,
            "row": 5
        }, {
            "column": 2,
            "answer": false,
            "row": 5
        }, {
            "column": 3,
            "answer": false,
            "row": 5
        }, {
            "column": 4,
            "answer": false,
            "row": 5
        }, {
            "column": 5,
            "answer": null,
            "row": 5
        }]
    }
}, {
    "info": {
        "imgNumber": "//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-09.jpg",
        "squares": [{
            "column": 0,
            "answer": null,
            "row": 0
        }, {
            "column": 1,
            "answer": null,
            "row": 0
        }, {
            "column": 2,
            "answer": false,
            "row": 0
        }, {
            "column": 3,
            "answer": true,
            "row": 0
        }, {
            "column": 4,
            "answer": false,
            "row": 0
        }, {
            "column": 5,
            "answer": null,
            "row": 0
        },

        {
            "column": 0,
            "answer": null,
            "row": 1
        }, {
            "column": 1,
            "answer": true,
            "row": 1
        }, {
            "column": 2,
            "answer": true,
            "row": 1
        }, {
            "column": 3,
            "answer": true,
            "row": 1
        }, {
            "column": 4,
            "answer": true,
            "row": 1
        }, {
            "column": 5,
            "answer": true,
            "row": 1
        },

        {
            "column": 0,
            "answer": true,
            "row": 2
        }, {
            "column": 1,
            "answer": true,
            "row": 2
        }, {
            "column": 2,
            "answer": true,
            "row": 2
        }, {
            "column": 3,
            "answer": true,
            "row": 2
        }, {
            "column": 4,
            "answer": true,
            "row": 2
        }, {
            "column": 5,
            "answer": true,
            "row": 2
        },

        {
            "column": 0,
            "answer": true,
            "row": 3
        }, {
            "column": 1,
            "answer": true,
            "row": 3
        }, {
            "column": 2,
            "answer": true,
            "row": 3
        }, {
            "column": 3,
            "answer": true,
            "row": 3
        }, {
            "column": 4,
            "answer": true,
            "row": 3
        }, {
            "column": 5,
            "answer": true,
            "row": 3
        },

        {
            "column": 0,
            "answer": true,
            "row": 4
        }, {
            "column": 1,
            "answer": true,
            "row": 4
        }, {
            "column": 2,
            "answer": true,
            "row": 4
        }, {
            "column": 3,
            "answer": true,
            "row": 4
        }, {
            "column": 4,
            "answer": true,
            "row": 4
        }, {
            "column": 5,
            "answer": true,
            "row": 4
        },


        {
            "column": 0,
            "answer": null,
            "row": 5
        }, {
            "column": 1,
            "answer": true,
            "row": 5
        }, {
            "column": 2,
            "answer": true,
            "row": 5
        }, {
            "column": 3,
            "answer": true,
            "row": 5
        }, {
            "column": 4,
            "answer": true,
            "row": 5
        }, {
            "column": 5,
            "answer": null,
            "row": 5
        }]
    }
}, {
    "info": {
        "imgNumber": "//citscitools.cancerresearchuk.org/static/mvp-images/bladder_ki67/Ki67-22.jpg",
        "squares": [{
            "column": 0,
            "answer": null,
            "row": 0
        }, {
            "column": 1,
            "answer": false,
            "row": 0
        }, {
            "column": 2,
            "answer": false,
            "row": 0
        }, {
            "column": 3,
            "answer": false,
            "row": 0
        }, {
            "column": 4,
            "answer": false,
            "row": 0
        }, {
            "column": 5,
            "answer": null,
            "row": 0
        },

        {
            "column": 0,
            "answer": false,
            "row": 1
        }, {
            "column": 1,
            "answer": false,
            "row": 1
        }, {
            "column": 2,
            "answer": false,
            "row": 1
        }, {
            "column": 3,
            "answer": false,
            "row": 1
        }, {
            "column": 4,
            "answer": false,
            "row": 1
        }, {
            "column": 5,
            "answer": false,
            "row": 1
        },

        {
            "column": 0,
            "answer": true,
            "row": 2
        }, {
            "column": 1,
            "answer": true,
            "row": 2
        }, {
            "column": 2,
            "answer": true,
            "row": 2
        }, {
            "column": 3,
            "answer": true,
            "row": 2
        }, {
            "column": 4,
            "answer": true,
            "row": 2
        }, {
            "column": 5,
            "answer": true,
            "row": 2
        },

        {
            "column": 0,
            "answer": true,
            "row": 3
        }, {
            "column": 1,
            "answer": true,
            "row": 3
        }, {
            "column": 2,
            "answer": true,
            "row": 3
        }, {
            "column": 3,
            "answer": true,
            "row": 3
        }, {
            "column": 4,
            "answer": true,
            "row": 3
        }, {
            "column": 5,
            "answer": true,
            "row": 3
        },

        {
            "column": 0,
            "answer": null,
            "row": 4
        }, {
            "column": 1,
            "answer": true,
            "row": 4
        }, {
            "column": 2,
            "answer": true,
            "row": 4
        }, {
            "column": 3,
            "answer": true,
            "row": 4
        }, {
            "column": 4,
            "answer": true,
            "row": 4
        }, {
            "column": 5,
            "answer": false,
            "row": 4
        },

        {
            "column": 0,
            "answer": null,
            "row": 5
        }, {
            "column": 1,
            "answer": null,
            "row": 5
        }, {
            "column": 2,
            "answer": true,
            "row": 5
        }, {
            "column": 3,
            "answer": true,
            "row": 5
        }, {
            "column": 4,
            "answer": null,
            "row": 5
        }, {
            "column": 5,
            "answer": null,
            "row": 5
        }]
    }
}];


"use strict";


/**
 * Grid Constructor function
 * =======================
 * Its a bit of a miss match of vanilla JS and jQuery...sorry,
 * wanted to do everything in JS but for speed i did jQuery
 * =======================
 *
 *
 */

function Grid(task) {
    this.canvas;
    this.task = task;
    this.zoomLensClickEvent();
}


/*
 For creating a grid overlayed over the image
 */

Grid.prototype.createGrid = function(canvasElement) {


    var rows = 6,
        columns = 6,
        gridHeight = 460 / columns,
        gridWidth = 460 / rows;

    this.canvas = Raphael(canvasElement, 460, 460);


    /*
     creates 36 grid squares in raphael
     */

    var x, y, i = -1;
    for (y = 0; y < rows; y += 1) {
        for (x = 0; x < columns; x += 1) {

            i++;

            var offsetH = y,
                offsetW = x,
                moveDown = (y + gridHeight - offsetH) * y,
                moveRight = (x + gridWidth - offsetW) * x,
                gridSquare = this.canvas.rect(moveRight, moveDown, gridWidth, gridHeight).attr({
                    "stroke": "#fff"
                });
            gridSquare.node.setAttribute("class", "grid-item");


            /*
             Make sure grid squares start from id 0
             */

            gridSquare.id = i;

            gridSquare.column = x;
            gridSquare.row = y;
            gridSquare.has_cancer = null;

            /*
             Save all grid squares in array within main task object
             We can then grab this when saving the info at the end
             */


            this.task.answer.squares.push(gridSquare);


        }
    }

};


/*
 Initalise and listen for the click on on the little zoom lens and then
 use Raphaeljs functions to find the closest square.
 */

Grid.prototype.zoomLensClickEvent = function() {

    var clicks = 0,
        timer = null,
        _this = this;

    $("body").on("click touchstart", ".zoomLens", function(evt) {
        evt.preventDefault();
        clicks++; //count clicks

        var activeSquare = _this.findClosestSquare();
        var activeSquareNode = activeSquare.node;


        /*
         Not able to use jQuery .click or .dblclick for some reason i can't remember
         If we can then should use jQuery...might be quicker and easier
         */

        if (activeSquareNode.className.animVal === "grid-item") {

            activeSquareNode.setAttribute("class", "grid-item grid-item-success");
            activeSquare.has_cancer = true;

        } else if (activeSquareNode.className.animVal === "grid-item grid-item-success") {

            activeSquareNode.setAttribute("class", "grid-item grid-item-error");
            activeSquare.has_cancer = false;

        } else {

            activeSquareNode.setAttribute("class", "grid-item");
            activeSquare.has_cancer = null;

        }


    });
};


/*
 Loop through the grid items and find the closest matching grid that have the clicked coordinates
 */

Grid.prototype.findClosestSquare = function() {

    var _this = this,
        activeSquare,
        target = $(".zoomLens"),
        target_pos = {
            x: parseInt(target.css("left")),
            y: parseInt(target.css("top"))
        };

    // Center the zoom cursor to middle of square
    target_pos.x = target_pos.x + 35.2;
    target_pos.y = target_pos.y + 35.2;


    // Find the closet grid item


    $.each(_this.task.answer.squares, function(key, value) {
        if (value.isPointInside(target_pos.x, target_pos.y)) {
            activeSquare = value;
        }
    });

    return activeSquare;
};


/*
 Selects all of the grid squares turning them red and changing the defalut
 square answer to "true" is does have cancer
 */

Grid.prototype.selectAllSquares = function() {
    for (var i = 0; i < this.task.answer.squares.length; i++) {
        var gridSquare = this.task.answer.squares[i],
            gridSquareNode = this.task.answer.squares[i].node;
        gridSquare.has_cancer = true;
        gridSquareNode.setAttribute("class", "grid-item grid-item-success");
    }
};


/*
 Deselects all of the grid squares turning them to have no fill color.
 This also changes the cancer value to "null"
 */

Grid.prototype.deselectAllSquares = function() {
    for (var i = 0; i < this.task.answer.squares.length; i++) {
        var gridSquare = this.task.answer.squares[i],
            gridSquareNode = this.task.answer.squares[i].node;
        gridSquare.has_cancer = null;
        gridSquareNode.setAttribute("class", "grid-item");
    }
};








/**
 * FeedbackGrid Constructor function
 * =======================
 * Its a bit of a miss match of vanilla JS and jQuery...sorry,
 * wanted to do everything in JS but for speed i did jQuery
 * =======================
 *
 *
 */

function FeedbackGrid() {
    this.canvas;
    this.tickCross = [];
    this.feedbackObj = {
        answer: {
            squares: []
        }
    };
    this.gridSquares = this.feedbackObj.answer.squares;
    this.zoomLensClickEvent();
}

/*
 For creating a grid overlayed over the image
 */

FeedbackGrid.prototype.createGrid = function(canvasElement) {
    var rows = 6;
    var columns = 6;
    var gridHeight = 460 / columns;
    var gridWidth = 460 / rows;
    this.canvas = Raphael(canvasElement, 460, 460);

    // Create a 6x6 grid using Raphaeljs elements so we can interact with them
    //
    //
    var x, y, i = -1;
    for (y = 0; y < rows; y += 1) {
        for (x = 0; x < columns; x += 1) {
            i++;
            var offsetH = y;
            var offsetW = x;
            var moveDown = (y + gridHeight - offsetH) * y;
            var moveRight = (x + gridWidth - offsetW) * x;
            var gridSquare = this.canvas.rect(moveRight, moveDown, gridWidth, gridHeight).attr({
                "stroke": "#fff"
            });

            // Make sure grid squares start from id 0
            //
            gridSquare.id = i;
            gridSquare.column = x;
            gridSquare.row = y;
            gridSquare.has_cancer = null;

            gridSquare.node.setAttribute("class", "grid-item");

            this.gridSquares.push(gridSquare);

        }
    }
};


/*
 Initalise and listen for the click on on the little zoom lens and then
 use Raphaeljs functions to find the closest square.
 */


FeedbackGrid.prototype.zoomLensClickEvent = function() {

    var _this = this;

    $("body").on("click", ".zoomLens", function(evt) {
        evt.preventDefault();

        //if(  step == 1 ) _this.hideMyAnalysis();

        var activeSquare = _this.findClosestSquare();
        var activeSquareNode = activeSquare.node;

        // Check the status of the clicked on grid square and
        // add a class to change its color. Also check if the pathologist
        // agreed with the users answer.
        //
        //
        if (activeSquareNode.className.animVal === "grid-item") {
            activeSquareNode.setAttribute("class", "grid-item grid-item-success");
            activeSquare.has_cancer = true;
            _this.checkAnswer(true, activeSquare);

        } else if (activeSquareNode.className.animVal === "grid-item grid-item-success") {
            activeSquareNode.setAttribute("class", "grid-item grid-item-error");
            activeSquare.has_cancer = false;
            _this.checkAnswer(false, activeSquare);

        } else {
            activeSquareNode.setAttribute("class", "grid-item");
            activeSquare.has_cancer = null;
            _this.checkAnswer(null, activeSquare);
        }
    });

};


/*
 Loop through the grid items and find the closest matching grid that have the clicked coordinates
 */

FeedbackGrid.prototype.findClosestSquare = function() {

    var _this = this;
    var activeSquare;

    // Find the position of the click on the zoomLens and then
    // center the point to the middle of the square.
    //
    //
    var target = $(".zoomLens");
    var target_pos = {
        x: parseInt(target.css("left")),
        y: parseInt(target.css("top"))
    };

    target_pos.x = target_pos.x + 35.2;
    target_pos.y = target_pos.y + 35.2;

    // Find the closet grid square to the point of the click
    // We use a Raphaeljs method isPointInside to return the element
    //
    //
    $.each(_this.gridSquares, function(idx, square) {
        if (square.isPointInside(target_pos.x, target_pos.y)) {
            activeSquare = square;
        }
    });

    return activeSquare;
};


/*
 After the grid square has been click we check that answer against what the
 pathologist said about the same square.
 */

FeedbackGrid.prototype.checkAnswer = function(action, activeSquare) {

    var _this = this;
    var pathologistAnswer;


    $.each(feedbackData[step].info, function(idx, patholgistSquare) {
        if (typeof(patholgistSquare[activeSquare.id]) == 'object') {
            // Find the pathologist answer for that square
            //
            //
            pathologistAnswer = patholgistSquare[activeSquare.id];
        }
    });

    // Check if that square already has a Tick or Cross marking,
    // if it does remove it and add a new marking
    //
    //
    this.removeTickOrCross(activeSquare);

    // When the incorrect grid square is fading out and the user
    // clicks on that square, stop the animation untill they have stopped
    // clicking.
    //
    //
    activeSquare.stop();

    activeSquare.animate({
        "fill-opacity": 1
    }, 100);

    // If pathologist agree with the answer given
    //
    //
    if (action === pathologistAnswer.answer) {

        var tick = this.addTick(activeSquare);

        if (step > 1) {
            $("#pathologistFeedback").hide();
            tick.attr("opacity", 0);
        } else {
            this.updateFeedbackProgress();
            this.updateFeedback(pathologistAnswer, true);
        }

    } else {

        var cross = this.addCross(activeSquare);
        if (step > 1) {
            $("#pathologistFeedback").hide();
            cross.attr("opacity", 0);
        } else {

            this.updateFeedbackProgress();
            this.updateFeedback(pathologistAnswer, false);

            activeSquare.animate({
                "fill-opacity": 1
            }, 2000, function() {
                activeSquare.attr("fill-opacity", 1)
                activeSquare.node.setAttribute("class", "grid-item");
            });
        }
    }

    // Check if the grid has been clicked, enable the "Check my work" button
    //
    //
    if (step > 1 && this.tickCross.length > 0) {
        $("#checkMyWorkBtn").removeClass("disabled");
    }


};

FeedbackGrid.prototype.removeTickOrCross = function(activeSquare) {
    var parentId = activeSquare.id;
    $.each(this.tickCross, function(idx, marking) {
        if (parentId === marking["data-parent_id"]) {
            marking.remove();
        }
    });
};


FeedbackGrid.prototype.addTick = function(activeSquare) {

    var x = Math.floor(activeSquare.attr("x")),
        y = Math.floor(activeSquare.attr("y")),
        parentId = activeSquare.id,
        tickPath = "M " + (x + 15) + "," + (y + 35) + " L " + (x + 30) + "," + (y + 50) + " L " + (x + 60) + "," + (y + 20);

    var tick = this.canvas.path(tickPath).attr({
        "stroke-width": "3px",
        "stroke-opacity": 0
    });

    var anim = Raphael.animation({
        "stroke-opacity": 1
    }, 250);
    tick.animate(anim.delay(1000));


    tick["data-parent_id"] = parentId;
    tick["class"] = "tick";
    this.tickCross.push(tick);

    return tick;
};


FeedbackGrid.prototype.addCross = function(activeSquare) {

    var x = Math.floor(activeSquare.attr("x"));
    var y = Math.floor(activeSquare.attr("y"));
    var parentId = activeSquare.id;
    var crossPath = "M " + (x + 20) + "," + (y + 20) + " L " + (x + 55) + "," + (y + 55) + "M " + (x + 20) + "," + (y + 55) + " L " + (x + 55) + "," + (y + 20);

    var cross = this.canvas.path(crossPath).attr({
        "stroke-width": "3px",
        "stroke-opacity": 0
    });

    var anim = Raphael.animation({
        "stroke-opacity": 1
    }, 250);
    cross.animate(anim.delay(1000));

    cross["data-parent_id"] = parentId;
    cross["class"] = "cross";
    this.tickCross.push(cross);

    return cross;
};


FeedbackGrid.prototype.updateFeedback = function(pathologistAnswer, state) {
    if (state) {
        $("#pathologistFeedback").removeClass("alert-info").addClass("alert-success");
        $("#pathologistFeedback p").html("<strong>Well done!</strong> Our pathologists agreed with you on that one. Keep going and try and do the whole grid. ");
    } else {
        $("#pathologistFeedback").removeClass("alert-success").addClass("alert-info");
        var htmlString = 'Our pathologists didn’t agree with you on that one.';
        htmlString += ' <strong>';
        if (pathologistAnswer.answer === true) {
            htmlString += 'They said this square contains cancer.';
        }
        if (pathologistAnswer.answer === false) {
            htmlString += 'They said this square did not contain cancer.';
        }
        if (pathologistAnswer.answer === null) {
            htmlString += 'They said this square was blank';
        }
        htmlString += '</strong>';
        //htmlString += ' Try again, and remember to look at the reference images below for guidance';
        $("#pathologistFeedback p").html(htmlString);
    }
    $("#pathologistFeedback").show();
    //$("#pathologistFeedback p").delay(4000).fadeOut(500);
};


/*
 Displays the pathologist tick's and cross's by changing the opacity of the square
 */

FeedbackGrid.prototype.showMyAnalysis = function() {

    this.updateFeedbackProgress();

    var feedbackObjAnswer = this.feedbackObj.answer;

    var crosses = [];
    $.each(this.tickCross, function(key, value) {
        value.attr("opacity", 1);
        if (value.class === "cross") {
            findParentSquare(value, feedbackObjAnswer);
        }
    });

    function findParentSquare(cross, feedbackObjAnswer) {

        for (var i = 0; i < feedbackData[step].info.squares.length; i++) {
            var gridSquare = feedbackObjAnswer.squares[i],
                gridSquareNode = feedbackObjAnswer.squares[i].node,
                pathologistAnswer = feedbackData[step].info.squares[i].answer;
            if (gridSquare.id === cross["data-parent_id"]) {
                gridSquare.node.setAttribute("class", "grid-item");
                gridSquare.animate({
                    "fill-opacity": 0
                }, 2000);

            }
        }
    }

};


FeedbackGrid.prototype.updateFeedbackProgress = function() {

    var $feedbackProgressBar = $("#feedbackProgress"),
        totalSquares = 36,
        correctSquares = 0;

    var blankSquares = this.checkBlankSquares();
    var interactedBlankSquares = this.interactedBlanks();

    totalSquares -= blankSquares;
    totalSquares += interactedBlankSquares;

    $.each(this.tickCross, function(key, value) {
        value.attr("opacity", 1);
        if (value["class"] === "tick") {
            correctSquares++;
        }
    });

    function between(x, min, max) {
        return x >= min && x <= max;
    }

    function percentage(x) {
        return Math.floor((x / totalSquares) * 100);
    }

    var pct = percentage(correctSquares);

    $(".progress").show();


    totalGridPercentage = pct;


    if (pct >= 5 && hasSeenGuidenceInfo === true) {
        $("#nextFeedbackStep, #finishFeedback").removeClass("disabled");
        $("#nextFeedbackStep, #finishFeedback").addClass("btn-primary");

        $(".taskTitle, .taskSubTitle, .taskParagraph").hide();
        $("#" + "feedbackStep" + step + " .taskFeedback").show();

    } else {
        $("#nextFeedbackStep, #finishFeedback").addClass("disabled");
    }

    this.percentageFeedbackText(pct);

    $feedbackProgressBar.width(pct + "%");
};

FeedbackGrid.prototype.percentageFeedbackText = function(pct) {
    var $feedbackText = $("#feedbackProgressText");
    var htmlString = '<h2>';
    if (pct >= 5) {
        htmlString += 'Well done! ';
    }
    htmlString += 'You\'ve marked ';
    htmlString += pct + '%</strong> of the image sections correctly</h2>';
    if (pct < 5) {
        htmlString += '<h3>Get 5% correct to go onto the next slide.</h3>';
    }
    $feedbackText.html(htmlString);

};


FeedbackGrid.prototype.checkBlankSquares = function() {

    var blankSquares = 0;
    $.each(feedbackData[step].info.squares, function(key, value) {
        if (value.answer === null) {
            blankSquares++;
        }
    });
    return blankSquares;

};


FeedbackGrid.prototype.interactedBlanks = function() {

    var pathologists = feedbackData[step].info.squares;
    var feedbackSquares = this.feedbackObj.answer.squares;
    var _this = this;
    var result = 0;

    feedbackSquares.forEach(function(square, idx) {
        var isBlank = (pathologists[idx].answer === null);

        // Loop through all of the items in the grid and find the ones which
        // have been interacted with
        //
        //
        var isInteracted = _this.tickCross.filter(function(sq) {
            return sq["data-parent_id"] === square.id;
        })[0] !== undefined;

        if (isBlank && isInteracted) {
            result++;
        }
    });

    return result;

};


/*
 *
 * Modal
 * =======================
 *
 *
 *
 */


function Modal() {
    this.step = -1;

}


/*
 Initialises the modal to open. We remove the functionaly to remove modal by clicking
 the backdrop also we stop the slides from automatically sliding to next.
 */

Modal.prototype.open = function(modall, goToStep) {




    this.modal = modall;
    this.tutorialStep = $(this.modal + " #" + this.step);

    $(this.modal).modal({
        backdrop: 'static',
        keyboard: false
    });


    this.showStep(goToStep);

};


Modal.prototype.getCurrentStep = function() {
    return $(this.modal + " #" + this.step);
};


Modal.prototype.showStep = function(action) {

    $(this.modal + " #" + this.step).hide();

    if (typeof action == "number") {
        this.step = action;
    } else {
        if (action == 'next') {
            this.step += 1;
        }
        if (action == 'prev') {
            this.step -= 1;
        }
    }

    var z = new Zoom();


    if (this.step == 14) {
        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();
        $(".tutorialZoom14").elevateZoom();
    }

    var $currentStep               = this.getCurrentStep(),
        currentModalStep           = this.modal + " #" + this.step,
        currentModalCarousel       = currentModalStep + " .carousel",
        currentModalInfo           = currentModalStep + " .modal-info",
        currentModalCarouselSlides = currentModalStep + " .item";

        // $carousel = $(this.modal + " #" + this.step + " .carousel"),
        // $modalInfo = $(this.modal + " #" + this.step + " .modal-info"),
        // $items = $(this.modal + " #" + this.step + " .item");



    // If modal step has a carousel
        //
        //
    if ($(currentModalCarousel).length > 0) {

        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();

        var $activeImgItem = $(this.modal + " #" + this.step + " .carousel-inner .item.active img");

        $activeImgItem.elevateZoom({
            zoomWindowPosition: "",
            lensFadeIn: 500,
            lensFadeOut: 500,
            zoomWindowHeight: 460,
            zoomWindowWidth: 460,
            cursor: "pointer"
        });


        // If the carousel has not been opened before
        //
        //
        if (!$(currentModalCarousel).data("carousel")) {

            $(currentModalCarousel).carousel({
                interval: false
            });

            var $indicatorList = $("#carouselIndicatorsList" + this.step);

            $(currentModalCarouselSlides).each(function(idx) {
                // Adding buttons
                idx++;
                var $item = $(this),
                    $li = '<div class="carousel-selector-' + idx + '" type="button">' + idx + '</div>';
                $indicatorList.append($li);
                //Adding item-info to modal-info
                $(this).children(".item-inner");
                $(currentModalInfo).append($item.children(".item-inner"));
            });


            $currentStep.find(".modal-info .item-inner").first().addClass("active");
            $currentStep.find(".carousel-indicators-custom div").first().addClass("active");

            // When you click on each selector
            // Load new content

            $('[class^=carousel-selector-]').on('click', this.nextSlideContent($currentStep));
        }
    }


    if (this.step === 0) {
        $("#prevBtn").hide();
    } else {
        $("#prevBtn").show();
    }

    if ($("#mechanicContent").is(':visible')) {
        $("#closeMechanicTutorialBtn").show();
        $("#tutorialSummary").hide();
        $("#mechanicTutorialSummary").show();
    }

    var $lastStep = $('#tutorialModal .modal-body').length - 1;
    if (this.step == $lastStep) {
        $("#nextBtn").hide();

        if ($("#mechanicContent").is(':visible')) {
            $("#startFeedbackBtn").hide();
            $("#goBackBtn").show();
        } else {
            $("#startFeedbackBtn").show();
            $("#goBackBtn").hide();
        }

    } else {
        $("#nextBtn").show();
        $("#startFeedbackBtn").hide();
    }

    $currentStep.show();

};


Modal.prototype.addZoomToSlide = function( evt ) {
    // console.log( evt );
    // var $currentStep = this.getCurrentStep(),
    //     $activeSlide = $currentStep.find(".carousel-inner .active"),
    //     $activeInfo = $currentStep.find(".modal-info .active");
}

/*
 If a step in the carousel includes a carousel with multiple slides
 find the content that relates to it and show it one by one.
 */

Modal.prototype.nextSlideContent = function(carousel) {
    var _this = this;
    return function() {


        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();

        var $carouselSelector = $(this),
            $carouselSlide = carousel.find(".modal-info .item-inner"),
            $modalId = _this.getCurrentStep().attr("id");

            $carouselSelector.parent().children().removeClass("active");
            $carouselSelector.addClass("active");

        var id_selector = $carouselSelector.attr("class");
        var id = parseInt(id_selector.substr(id_selector.length - 8));

        $carouselSlide.removeClass('active');

        var nextSlideInfo = $($carouselSlide[id - 1]);
            nextSlideInfo.addClass('active');


        var $zoomArea = nextSlideInfo.parent();
        var $currentSlideImg = $(".tutorialZoom" + $modalId)[id - 1];

        $( $currentSlideImg ).elevateZoom({
            zoomWindowPosition: "",
            lensFadeIn: 500,
            lensFadeOut: 500,
            zoomWindowHeight: 460,
            zoomWindowWidth: 460,
            cursor: "pointer"
        });


        $('#myCarousel' + $modalId ).carousel(id - 1);

        //_this.addZoomToSlide();
    };

};


/*
 *
 * Elevate Zoom
 * =======================
 *
 *
 */


function Zoom() {

}


Zoom.prototype.addZoom = function(element) {
    //alert("zoom");
    var cookie = $.cookie(cookie_feedback_name),
        zoomWindowPos;

    if (cookie === "true")
        zoomWindowPos = "feedbackZoomWindowLocation";
    else
        zoomWindowPos = "mechanicZoomWindowLocation";


    var zoomWindowPosHeight = $("#" + zoomWindowPos).innerHeight(),
        zoomWindowPosWidth = $("#" + zoomWindowPos).innerWidth();

    //console.log(zoomWindowPosHeight,zoomWindowPosWidth);

    element.elevateZoom({
        zoomWindowPosition: zoomWindowPos,
        lensFadeIn: 500,
        lensFadeOut: 500,
        zoomWindowHeight: 460,
        zoomWindowWidth: 460,
        cursor: "pointer"
    });


};


Zoom.prototype.removeZoom = function(element) {
    $.removeData(element, 'elevateZoom');
    $('.zoomContainer').remove();
    $('.zoomWindowContainer').remove();
};


/*
 *
 * Helpful functions
 * =======================
 *
 *
 */


/*
 Loads user progress into Grid info
 */

function loadUserProgress() {
    pybossa.userProgress('mvp-04b').done(function(data) {
        var currentTask = data.done + 1;
        $("#tasksCompleted").text(currentTask + " of " + data.total);
        var pct = Math.round((data.done * 100) / data.total);
        $("#progress").css("width", pct.toString() + "%");
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}


/*
 Uses device.js and works out what device we are using
 */

function whatDevice() {
    var desktop = device.desktop(),
        mobile = device.mobile(),
        tablet = device.tablet(),
        portrait = device.portrait(),
        landscape = device.landscape(),
        iphone = device.iphone(),
        android = device.android(),
        androidTablet = device.androidTablet(),
        blackberryTablet = device.blackberryTablet();


    if (desktop) return "Desktop";
    if (mobile && portrait) return "Mobile portrait";
    if (mobile && portrait) return "Mobile landscape";
    if (tablet && portrait) return "Tablet portrait";
    if (tablet && landscape) return "Tablet landscape";
}


/*
 Finds out how long the user has spent on the particular task.
 We then return this value back into the task.answer object which we get back in pybossa
 */

function secondsToString(seconds) {
    var numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);
    var numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);
    var numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;
    return numhours + ":" + numminutes + ":" + numseconds.toFixed(2);
}


/*
 We use modenizr to find out with browser we are on and what version.
 Then it returns this value back into the task.answer object which we get back in pybossa
 */

var BrowserDetect = {
    init: function() {
        this.browser = this.searchString(this.dataBrowser) || "Other";
        this.version = this.searchVersion(navigator.userAgent) || this.searchVersion(navigator.appVersion) || "Unknown";
    },
    searchString: function(data) {
        for (var i = 0; i < data.length; i++) {
            var dataString = data[i].string;
            this.versionSearchString = data[i].subString;

            if (dataString.indexOf(data[i].subString) !== -1) {
                return data[i].identity;
            }
        }
    },
    searchVersion: function(dataString) {
        var index = dataString.indexOf(this.versionSearchString);
        if (index === -1) {
            return;
        }

        var rv = dataString.indexOf("rv:");
        if (this.versionSearchString === "Trident" && rv !== -1) {
            return parseFloat(dataString.substring(rv + 3));
        } else {
            return parseFloat(dataString.substring(index + this.versionSearchString.length + 1));
        }
    },

    dataBrowser: [{
        string: navigator.userAgent,
        subString: "Chrome",
        identity: "Chrome"
    }, {
        string: navigator.userAgent,
        subString: "MSIE",
        identity: "Explorer"
    }, {
        string: navigator.userAgent,
        subString: "Trident",
        identity: "Explorer"
    }, {
        string: navigator.userAgent,
        subString: "Firefox",
        identity: "Firefox"
    }, {
        string: navigator.userAgent,
        subString: "Safari",
        identity: "Safari"
    }, {
        string: navigator.userAgent,
        subString: "Opera",
        identity: "Opera"
    }]

};

BrowserDetect.init();

/*
 For displaying a message on IE

 if (BrowserDetect.browser == 'Explorer') {
 //$(".wrappy").addClass("active");
 }
 */




/*
 * PyBossa functions
 * =======================
 * taskLoaded is the first pybossa method that is called
 * =======================
 *
 *
 */


pybossa.taskLoaded(function(task, deferred) {

    if (!$.isEmptyObject(task)) {

        var img = $('<img />');

        img.load(function() {
            $("#loadingTask").hide();
            loadUserProgress();
            deferred.resolve(task);
        });

        img.attr('src', task.info.url_b).css('height', 460);
        img.attr('data-zoom-image', task.info.url_b);
        img.addClass('img-polaroid');
        task.info.image = img;

        task.answer = {
            squares: [],
            timeTaken: "",
            device: "",
            browser: "",
            img: "",
            openModalCount: 0
        };


        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
    } else {

        deferred.resolve(task);
    }

});


/*
 This grabs the task via an API call using pybossa.js. We retreive all of the task infomation
 in an object called task that we pass into the presentTask method. We first check if there is a task
 If there is then we initalize the Grid constructor and other methods.
 */

pybossa.presentTask(function(task, deferred) {

    if (!$.isEmptyObject(task)) {


        if (task.state == 'completed') {
            $("#loading").hide();
        }

        var openModalCount = 0;

        /*
         Take a time stamp of the time the page loads
         */
        var oldTime = new Date();


        /*
         Load the task image into the page
         */

        $('#photo-link').html('').append(task.info.image);
        $('#task-id').html(task.id);
        var imgUrl = task.info.url_b;

        var lastSlashIdx = imgUrl.lastIndexOf("/");
        var newStr = imgUrl.substr(lastSlashIdx + 1, 10);
        $(".imgId").html("Image ID: " + "<strong>" + newStr + "</strong>");


        /*
         Initalise main mechanic, zoom and modal
         */

        var grid = new Grid(task);
        grid.createGrid("mechanicCanvas");

        var zoom = new Zoom();
        zoom.addZoom($(".img-polaroid"));


        var modal = new Modal();

        var showTutorialModalBtn = document.getElementById("showTutorialModalBtn");
        showTutorialModalBtn.onclick = function() {
            modal.open("#tutorialModal", 0);
            $(".grid-info-buttons").css("z-index", 1000);
            $("#tutorialSummary").hide();
            $("#mechanicTutorialSummary").show();
            zoom.removeZoom($(".tutorialZoom"));
            openModalCount++;
        };

        var closeMechanicTutorialBtn = document.getElementById("closeMechanicTutorialBtn");
        closeMechanicTutorialBtn.onclick = function() {
            $(".grid-info-buttons").css("z-index", 2500);
            zoom.removeZoom($(".tutorialZoom"));
            $("#errorClick").show();
            zoom.addZoom($(".img-polaroid"));
        };


        var goBackBtn = document.getElementById("goBackBtn");
        goBackBtn.onclick = function() {
            zoom.removeZoom($(".tutorialZoom"));
            zoom.addZoom($(".img-polaroid"));
            //$(".modal-body").hide();
            $("#errorClick").show();
        };

        var errorClickCrossBtn = document.getElementById("errorClickCross");
        errorClickCrossBtn.onclick = function() {
            $("#errorClick").hide();
        };

        var nextBtn = document.getElementById("nextBtn");
        nextBtn.onclick = function() {

            modal.showStep('next');
        };

        var prevBtn = document.getElementById("prevBtn");
        prevBtn.onclick = function() {

            modal.showStep('prev');
        };


        /*
         "Next Slide" Button
         */

        $('.btn-answer').off('click').on('click', function() {

            // Grab a new timestamp and find out the difference
            // This is how long the user has been on the task for
            // Then pass it into the answer
            var newTime = new Date(),
                ms = newTime - oldTime,
                x = ms / 1000,
                seconds = secondsToString(x);

            // Pass image number into answer
            var imgUrl = task.info.url_b;
            var result = imgUrl.replace("//citscitools.cancerresearchuk.org/static/img/mvp-01/", "");


            // Create the answer object
            var answer = {
                squares: [],
                timeTaken: seconds,
                device: whatDevice(),
                browser: BrowserDetect.browser + " V." + BrowserDetect.version,
                imgNumber: result,
                openModalCount: openModalCount
            };


            // Change the square object to have clearer values
            $.each(grid.task.answer.squares, function(key, value) {
                var obj = {
                    column: value.column,
                    row: value.row,
                    answer: value.has_cancer
                };
                answer.squares.push(obj);
            });

            console.log(answer);

            /*
             * Save the task information and send to PyBossa
             */

            pybossa.saveTask(task.id, answer).done(function(data) {
                loadUserProgress();
                $("#success").fadeIn(500).delay(1500).fadeOut();
                $("svg, .zoomContainer,.zoomWindowContainer").remove();
                deferred.resolve();
            });

        });
    } else {


        $("#loading").hide();
        $("#progress").css("width", "100%");
        $("#finish").fadeIn(500);
        $(".site-content").fadeTo("slow", 0.5);
        $(".site-content").css("pointer-events", "none;");
    }
});


/*
 *  Feedback function
 *  =======================
 *  This has multiple steps that include and init a new grid
 *  we use this funciton to keep the progress through the steps
 *
 */




var step = -1;

function showFeedbackStep(action) {


    $("svg").remove();
    $(".feedback-img-polaroid").remove();
    $(".zoomContainer").remove();
    $(".zoomWindowContainer").remove();

    if (action == 'next') {
        step += 1;
        $("#nextFeedbackStep, #checkMyWorkBtn #finishFeedback").addClass("disabled");
        $("#nextFeedbackStep, #finishFeedback").removeClass("btn-primary");
    }


    var feedbackGrid = new FeedbackGrid();
    var modal = new Modal();
    var zoom = new Zoom();

    hasSeenGuidenceInfo = false;
    totalGridPercentage = 0;


    $("#feedbackStep" + step).hide();

    var data_obj = feedbackData[step].info;
    var imgUrl = feedbackData[step].info.imgNumber;

    var img = $('<img />');
    img.attr('src', imgUrl);
    img.attr('data-zoom-image', imgUrl);
    img.addClass('feedback-img-polaroid');

    $('#feedbackPhotoWrapper').append(img);


    $(img).load(function() {
        feedbackGrid.createGrid("feedbackCanvas");
        zoom.addZoom($(".feedback-img-polaroid"));
    });




    if (step >= 2) {
        $("#nextFeedbackStep").addClass("disabled");
        $("#checkMyWorkBtn").show().addClass("disabled");
    }

    if (step === 2) { // if is step 3
        $(".zoomContainer").remove();
        $(".zoomWindowContainer").remove();

        $("#practiseModal .modal-body").hide();
        modal.open("#practiseModal", 5);
        $(".grid-info-buttons").css("z-index", 1000);
    }






    var checkMyWork = document.getElementById("checkMyWorkBtn");
    checkMyWork.onclick = function() {
        if ($(this).hasClass("disabled")) return;

        if (totalGridPercentage >= 5) {
            $("#nextFeedbackStep").removeClass("disabled");
            $("#finishFeedback").removeClass("disabled");
            $("#nextFeedbackStep, #finishFeedback").addClass("btn-primary");
        }


        //$(".taskTitle,.taskSubTitle, .taskParagraph ").hide();
        //$("#" + "feedbackStep" + step + " .taskFeedback").show();
        feedbackGrid.showMyAnalysis();
    };

    var lastFeedbackStep = feedbackData.length;
    if (step === lastFeedbackStep - 1) {
        $("#nextFeedbackStep").hide();
        $("#finishFeedback").show().addClass("disabled");
    }

    $("#feedbackStep" + step).show();
    $("#feedbackImageNumber").text(step + 1);

}







/*
 * UpdatePageState
 * =======================
 * We use this check the state of cookies to show the relevate sections
 * the three sections are "tutorial", "feedback" and "mechanic"
 *
 */

function UpdatePageState() {

    // State of the page to show to the user
    var page_state = "mechanic";

    // Check if the page should be in show feedback state
    var cookie_feedback = $.cookie(cookie_feedback_name);
    if (cookie_feedback !== null)
        page_state = "feedback";

    // Check if the page should be in tutorial state
    var cookie_tutorial = $.cookie(cookie_tutorial_name);
    if (cookie_tutorial === null || cookie_tutorial != "seen")
        page_state = "tutorial";

    // Check if the page should be in show feedback state
    if (cookie_feedback == "false")
        page_state = "mechanic";


    // If the feedback or mechanic is showing
    // Init the example images in slick corousel
    //
    //
    if (page_state == "feedback" || page_state == "mechanic") {
        $('.example-list').show();
        /* THESE AND ERROR PUMPING OUT WITH THIS !?!
         */
        $('.example-list').slick({
            dots: false,
            infinite: false,
            speed: 300,
            slidesToScroll: 5,
            slidesToShow: 5,
        });
    }

    if (page_state == "tutorial") {
        $("body").addClass("tutorial-active");

        var m = new Modal();
        m.open("#tutorialModal", "next");

        $("#feedbackContent").hide();

        var nextBtn = document.getElementById("nextBtn");
        nextBtn.onclick = function() {
            m.showStep('next');
        };

        var prevBtn = document.getElementById("prevBtn");
        prevBtn.onclick = function() {
            m.showStep('prev');
        };

    } else if (page_state == "feedback") {
        showFeedbackStep('next');
        $("#feedbackContent").show();
        $("body").addClass("feedback-active");
        $("body").removeClass("tutorial-active");
    } else {
        $("#feedbackContent").hide();
        $("body").addClass("mechanic-active");
        $("body").removeClass("feedback-active");
        $("#mechanicContent").show();
        pybossa.run("mvp-04b");
    }

}









$(function() {

    UpdatePageState();


    /*
        CLICK EVENTS FOR:
            END OF TUTORIAL,
            FEEDBACK AND
            MECHANIC
     */

    // End of the tutorial
    //
    //

    var startFeedbackBtn = document.getElementById("startFeedbackBtn");
    startFeedbackBtn.onclick = function() {
        $("#tutorialModal .modal-body").hide();
        $.cookie(cookie_tutorial_name, "seen");
        $.cookie(cookie_feedback_name, true);
        UpdatePageState();

    };

    // End of feedback/practice round
    //
    //

    var finishFeedback = document.getElementById("finishFeedback");
    finishFeedback.onclick = function() {
        if ($(this).hasClass("disabled")) return;
        $("svg, .feedback-img-polaroid, .zoomContainer, .zoomWindowContainer").remove();
        //$.removeData(".feedback-photo-link", 'elevateZoom');
        $("#backToPractiseBtn").hide();
        $("#startMechanicBtn").show();

        $("#practiseModal .modal-body").hide();

        var m = new Modal();
        m.open("#practiseModal", 6);
        $(".grid-info-buttons").css("z-index", 1000);
    }



    var startMechanicBtn = document.getElementById("startMechanicBtn");
    startMechanicBtn.onclick = function() {
        $(".grid-info-buttons").css("z-index", 2500);
        $.cookie(cookie_feedback_name, false);
        UpdatePageState();
    }




    /*
        CLICK EVENTS
            FOR FEEDBACK/PRACTISE SECTION

     */

    var nextFeedbackBtn = document.getElementById("nextFeedbackStep");
    nextFeedbackBtn.onclick = function() {
        if ($(this).hasClass("disabled")) return;
        $("#feedbackProgress").width("0%");
        $("#feedbackProgressText").text("");
        if (step != feedbackData.length - 1) {
            showFeedbackStep('next');
        }
    };




    var feedbackInfoBtn = document.getElementById("feedbackInfoBtn");
    feedbackInfoBtn.onclick = function() {
        $(".grid-info-buttons").css("z-index", 1000);

        $("#practiseModal .modal-body").hide();

        var annotatedImage = "#practiseModal" + " #" + step + " .annotatedImage";
        var modal = new Modal();
        modal.open("#practiseModal", step);
        var zoom = new Zoom();

        zoom.removeZoom($(".feedback-img-polaroid"));

        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();

        var practiseGridInfo = "annotatedImageZoomArea" + step;
        $(annotatedImage).elevateZoom({
            zoomWindowPosition: practiseGridInfo,
            lensFadeIn: 500,
            lensFadeOut: 500,
            zoomWindowHeight: 460,
            zoomWindowWidth: 460,
            cursor: "pointer"
        });

    };

    var backToPractiseBtn = document.getElementById("backToPractiseBtn");
    backToPractiseBtn.onclick = function() {

        $(".grid-info-buttons").css("z-index", 2500);

        if (totalGridPercentage >= 5) {
            $("#nextFeedbackStep").removeClass("disabled");
            $("#finishFeedback").removeClass("disabled");
            $("#nextFeedbackStep, #finishFeedback").addClass("btn-primary");
        }

        if (step !== 2) {
            hasSeenGuidenceInfo = true;
        } else {
            hasSeenGuidenceInfo = false;
        }

        var zoom = new Zoom();
        zoom.removeZoom($("#practiseModal" + " #" + step + " .annotatedImage"));

        $('.zoomContainer').remove();
        $('.zoomWindowContainer').remove();

        $(".feedback-img-polaroid").elevateZoom({
            zoomWindowPosition: "feedbackZoomWindowLocation",
            lensFadeIn: 500,
            lensFadeOut: 500,
            zoomWindowHeight: 460,
            zoomWindowWidth: 460,
            cursor: "pointer"
        });

    };


});
</script>
