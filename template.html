<style type="text/css">


     /*
     * For styling the tutorial modal component
     * Need to make this responsive and cross browser compatable
     */

    .modal {
        width: 800px;
        margin-left: -400px;
        top: 45%;
    }

    .modal .modal-body {
        max-height: 600px;
        display: table;
        padding: 0;
    }

    .modal-header {
        text-align: center;
    }

    .modal.fade.in {
  top: 45%;
}

    /*
     * Modal body split into two sections
     * left is the .modal-image (contains image and carousel)
     * right is the .modal-info (contains text)
     */

    .modal .modal-body .modal-image,
    .modal .modal-body .modal-info {
        float: left;
        word-break: keep-all;
    }

    .modal .modal-body.has-info .modal-image {
        width: 460px;
    }
    .modal .modal-body.has-info .modal-info {
        width: 300px;
        padding: 20px;
    }

    .modal .modal-body .carousel {
        margin-bottom: 0;
    }

    .modal .modal-body .carousel-control {
        top: 92%;
    }

    .carousel-control.left {
        left: 85%;
    }

    .modal .modal-body .modal-image img {
        width: 460px;
        float: left;
    }

    .modal .modal-body .item-content {
        float: right;
        width: 300px;
        padding: 20px;
    }



    /*
     * Utility to clear floats
     */
    .clearfix:before,
    .clearfix:after {
        content: " ";
        display: table;
    }

    .clearfix:after {
        clear: both;
    }

    /*
     * Left column with grid infomation
     */

    .grid-info {
        background-color: #efefef;
        padding: 20px;
        box-sizing: border-box;
    }

    .grid-info span {
        font-size: 18px;
    }

    /*
     * Right column including grid
     */
    .grid-wrapper {
        position: relative;
        height: 460px;
    }

    .grid {
        position: absolute;
        top: 0;
        width: 100%;
        border-spacing: 0;
    }

    .img-polaroid {
        position: absolute;
        z-index: 1;
        top: 0;
        padding: 0;
        width: 100%;
        height: auto;
    }

    rect.grid-item.grid-item-success {
        fill: rgba(231, 76, 60, .8);
    }

    rect.grid-item.grid-item-error {

        fill: rgba(0, 163, 136, .5);
    }

    #zoom_01 {
        width: 400px;
    }

    #canvas {
        position: absolute;
        top: 0;
        z-index: 10;
    }

    .zoomContainer {
        z-index: 100;
    }

    .zoomLens {
        height: 70px;
        width: 70px;
    }

    .example-list {
        margin-bottom: 40px;
    }

    .example-list-item {
        position: relative;
        width: 20%;
        float: left;
        margin: 0;
        overflow: hidden;
        box-sizing: border-box;
    }

    .example-list-item:hover .description {
        opacity: 1;
        left: 0;
    }

    .example-list-item .description {
        position: absolute;
        bottom: 0;
        display: block;
        text-align: center;
        width: 100%;
        color: white;
        font-family: sans-serif;
        font-weight: 100;
        letter-spacing: 1px;
        background-color: rgba(0, 0, 0, 0.6);
    }

    .nextSlideBtn {
        float: right;
    }

    #difficulty {
        width: 100%;
    }

    .progress {
        margin-bottom: 0;
        margin-top: 20px;
    }

    .site-header .alert {
        text-align: center;
    }
</style>


<!--MODAL-->
<div class="row">
    <div class="span12">
        <div id="modal" class="modal hide fade">
            <div class="modal-header">
                    <h2>Trailblazer project - Tutorial</h2>
            </div>
            <div id="0" class="modal-body" style="display:none">
                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/first-image.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <p>
                        Our scientists need help analysing cancer cells. They have lots of questions but not enough time to look at their piles of images. So, we’d like your help. All you need to do is try to  identify the cancer cells in images like the one below.
                    </p>

                    <p>
                        Before you start, here’s some information about:
                    </p>
                    <ul>
                        <li>What a cell is and its different parts</li>
                        <li>How cancer cells develop</li>
                        <li>Spotting cancer cells vs the other cells you will see</li>
                        <li>Why some bits of the image are blue and others are brown</li>
                    </ul>
                </div>

            </div>


            <!-- First Carousel -->

            <div id="1" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div id="myCarousel" class="carousel slide">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides1/cell-structure.png" alt=""/>
                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <h1 id="itemTitle">The basic structure of a human cell consists of:</h1>
                                        <ul>
                                            <li>A control room in the centre of the cell called a nucleus</li>
                                            <li>Surrounded by the space where most of the cell’s jobs get done, the cytoplasm</li>
                                            <li>All enclosed in a cell membrane</li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides1/cell-microvilli.png" alt=""/>
                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h1 id="itemTitle">But in reality, cells are far more complex and made up of highly specialised features. These are fine tuned to the specific tasks they need to perform. For example:</h1>

                                        <p id="itemParagraph">Cells making up the surface of the small intestine have finger like shapes on one side called microvilli. These increase the surface area so they can absorb more nutrients from your food </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides1/nerve-ending.png" alt=""/>
                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h1 id="itemTitle">But in reality, cells are far more complex and made up of highly specialised features. These are fine tuned to the specific tasks they need to perform. For example:</h1>

                                        <p id="itemParagraph">Meanwhile, nerve cells are designed to be a rapid message delivery network. They have multiple branches, called dendrites, on one end receiving signals from their neighbours. A long cable like structure called the axon passes the signal on as an electrical message</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- Carousel nav -->
                        <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
                    </div>

                </div>
                <!--<div class="modal-info"></div>-->
            </div>



             <!-- forth Carousel -->

            <div id="2" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div id="myCarousel4" class="carousel slide">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides4/healthy-section.jpg" alt=""/>
                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <h2>
                                            Under a microscope it can be difficult to see the outline and structure of cells. Therefore, scientists add stains that stick to certain parts of the cell and make it easier to see them. One commonly used stain is haematoxylin which turns just the nucleus of cells blue. Here are some examples
                                        </h2>
                                        <p>
                                            This is a section from the surface of the lung. The nuclei of the cells that make up the surface, epithelial cells, can be seen in blue. Specialised, hair-like structures called cilia can also just be made out. In healthy lungs, these are responsible for wafting mucus out of the lungs. The blue nuclei of white blood cells can also be seen
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides4/white-blood-cells.jpg" alt=""/>
                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h2>
                                            Under a microscope it can be difficult to see the outline and structure of cells. Therefore, scientists add stains that stick to certain parts of the cell and make it easier to see them. One commonly used stain is haematoxylin which turns just the nucleus of cells blue. Here are some examples
                                        </h2>
        <p>
            This image is a close up of a cluster of white blood cells. All the nuclei are stained in blue with haematoxylin making them easy to distinguish. Other cell structures cannot be seen as the stain does not stick to them
        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- Carousel nav -->
                        <a class="carousel-control left" href="#myCarousel4" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel4" data-slide="next">&rsaquo;</a>
                    </div>

                </div>
                <!--<div class="modal-info"></div>-->
            </div>






            <!-- Second Carousel -->

            <div id="3" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div id="myCarousel2" class="carousel slide">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides2/village.png" alt=""/>
                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <p>
                                            Cancer develops when mistakes start building up in the nucleus, the control room of the cells, to the point that control over the cell is lost. The cell starts to lose many of its specialised features, stops behaving properly and starts replicating uncontrollably.
You can think about it like a small, organised village with houses of similar shapes and sizes transforming into a sprawling, rapidly expanding city.
                                        </p>
                                        <p>
                                            Healthy cells  are strictly organised and regulated. They all have a similar shape and size and are neatly arranged. Their shape, behaviour and all interactions with their neighbours is tightly monitored and controlled.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides2/towns.png" alt=""/>
                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">

                                    <p>Cancer cells do not look like healthy cells. With loss of control and regulation the cells start to take on more varied and relaxed  shapes and behaviours. Producing more cells becomes more important than creating healthy, well maintained and fully functioning cells.

Our 'village' is rapidly expanding, with buildings of all shapes and sizes sprouting up wherever they find space. </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides2/city.png" alt=""/>
                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <p>
                                            With complete loss of control, individual cancer cells take on all kinds of strange shapes, sizes and behaviours. Eventually this turns into a sprawling mass of cells with only basic underlying infrastructure keeping the mass of cells going. It is hard to predict exactly what they will look like other than they will look disorganised, dissimilar to each other and generally chaotic

Our 'village' has become an uncontrolled, varied, overcrowded city.
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <!-- Carousel nav -->
                        <a class="carousel-control left" href="#myCarousel2" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel2" data-slide="next">&rsaquo;</a>
                    </div>

                </div>
                <!--<div class="modal-info"></div>-->
            </div>






            <div id="4" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div id="myCarousel3" class="carousel slide">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides3/cancer-cells-example-1.jpg" alt=""/>
                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <p>
                                            The cancer cells in the images below are outlined in red. Red arrows are pointing to larger clumps.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides3/cancer-cells-example-2.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <p>
                                            However, a tumour consists of more than just cancer cells. There is often a lot of stringy and tough tissue called stroma. The Stromal cells provide structure and support to the cancer cells.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides3/cancer-cells-example-3.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <p>
                                            There also tends to be a lot of small, round solid looking white blood cells (but they’ll look blue in these images) near the site of a tumour.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides3/cancer-cells-example-4.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <p>
                                            The cancer cells in the images below are outlined in red. Red arrows are pointing to larger clumps.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides3/1b.png" alt=""/>

                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <p>
                                            The cancer cells in the images below have been blocked out in red. The remaining cells are the stringy, whispy cells of the stroma and small, round solid looking blood cells- some of which we've circled in green.
                                        </p>
                                    </div>
                                </div>

                            </div>


                        </div>
                        <!-- Carousel nav -->
                        <a class="carousel-control left" href="#myCarousel3" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel3" data-slide="next">&rsaquo;</a>
                    </div>

                </div>
                <!--<div class="modal-info"></div>-->
            </div>










             <!-- fifth Carousel -->

            <div id="5" class="modal-body" style="display:none">
                <div class="modal-image">
                    <div id="myCarousel5" class="carousel slide">
                        <!-- Carousel items -->
                        <div class="carousel-inner">
                            <div class="active item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides5/p53-nuclear-stain.jpg" alt=""/>
                                <div class="item-content" id="itemContent">
                                    <div class="item-content-inner">
                                        <h2>
                                            Scientists researching cancer often want to know if a cell is storing or making a certain molecule. To answer this question they use special stains that only stick to the molecule they want to investigate. These are called immnunostains and turn parts of the cell brown wherever the specific molecule is present. Here are some examples.
                                        </h2>
                                        <p>
                                            This stain sticks to a molecule called p53. Some of these cancer cells have got brown nuclei. This means they have p53 in their nuclei. However, some of the nuclei are still blue so not all the cells have p53 present in their nuclei.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides5/hdac4-cytoplasm-staining.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h2>
                                            Scientists researching cancer often want to know if a cell is storing or making a certain molecule. To answer this question they use special stains that only stick to the molecule they want to investigate. These are called immnunostains and turn parts of the cell brown wherever the specific molecule is present. Here are some examples.
                                        </h2>
                                        <p>
                                            These cells have been stained for a molecule called HDAC4. We can see that the cytoplasm is has turned brown so must contain HDAC4. The nuclei are all blue so the nuclei of these cells do not contain any HDAC4. As we cannot see well defined cell membranes here (like we can with the HER2 example) so we can assume that the cell membranes also do not hold any HDAC4.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides5/her2-membrane-stain.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h2>
                                            Scientists researching cancer often want to know if a cell is storing or making a certain molecule. To answer this question they use special stains that only stick to the molecule they want to investigate. These are called immnunostains and turn parts of the cell brown wherever the specific molecule is present. Here are some examples.
                                        </h2>
                                        <p>
                                            This stain identifies a molecule called HER2 which is very important in breast cancer. We can see that there are cancer cells here with brown membranes indicating they are “presenting” HER2 on their cell membranes. To the right are the small blue nuclei of white blood cells that are not presenting HER2.
                                        </p>
                                    </div>
                                </div>

                            </div>
                            <div class="item">
                                <img src="//citscitools.cancerresearchuk.org/static/img/mvp-02/mvp-02b/slides5/cd8-stained-white-blood-cells.jpg" alt=""/>

                                <div class="item-content" id="itemContent">

                                    <div class="item-content-inner">
                                        <h2>
                                            Scientists researching cancer often want to know if a cell is storing or making a certain molecule. To answer this question they use special stains that only stick to the molecule they want to investigate. These are called immnunostains and turn parts of the cell brown wherever the specific molecule is present. Here are some examples.
                                        </h2>
                                        <p>
                                            This sample has been stained for a molecule called CD8 which plays an important role in our body’s fight against certain types of disease. We can see that some of the white blood cells here have stained brown, so are presenting CD8, but most are not.
                                        </p>
                                        <p>
                                            <b>
                                                The images you will be looking at have been stained for CD8. Any brown spots you see are white blood cells that are carrying this molecule
                                            </b>
                                        </p>
                                    </div>
                                </div>

                            </div>


                        </div>
                        <!-- Carousel nav -->
                        <a class="carousel-control left" href="#myCarousel5" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel5" data-slide="next">&rsaquo;</a>
                    </div>

                </div>
                <!--<div class="modal-info"></div>-->
            </div>


             <div id="6" class="modal-body" style="display:none">

                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>Let’s run through an example</h1>

                    <p>
                        We have split the images up into a 6x6 grid. Some of the grid sections contain cancer cells and some of them do not. We’re going to show you what to do.
                    </p>
                </div>
            </div>

            <div id="7" class="modal-body" style="display:none">

                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/zoomed-in.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>Look closely at the cells in each section</h1>

                    <p>
                        Like we have done here, you can hover over the cells in each section to pull up a zoomed in version and get a closer look.
                    </p>
                </div>
            </div>

            <div id="8" class="modal-body" style="display:none">

                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>We’ve clicked once to highlight sections containing cancer cells red</h1>

                    <p>
                        Examine each section and if you think it contains cancer cells (even if you only see one or two cells) click once to turn that section red.
                    </p>
                </div>

            </div>
            <div id="9" class="modal-body" style="display:none">

                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red-green.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>We’ve clicked twice to highlight sections that do <b>not contain</b> cancer cells green</h1>

                    <p>
                        Examine each section and if you think it
                        <b>does not</b> contain any cancer cells, you can double click to turn that section green.
                    </p>

                    <p>
                        Before you start analysing, lets take a closer look at some samples
                    </p>
                </div>

            </div>

            <div id="10" class="modal-body" style="display:none">

                <div class="modal-image">
                    <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/tutorial/grid-red-green.jpg" alt=""/>
                </div>
                <div class="modal-info">
                    <h1>Empty sections can be left blank</h1>

                    <p>
                        You can ignore any sections that are empty, normally corner and edge sections (but not always).
                    </p>

                    <p>
                        You can then click on the green “Next slide” to move onto the next sample.
                    </p>
                </div>

            </div>


            <div class="modal-footer">
                 <a class="btn pull-left closeBtn" data-dismiss="modal" aria-hidden="true">Close</a>
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <a id="goBackBtn" class="btn btn-primary closeBtn" style="display:none" data-dismiss="modal" aria-hidden="true"><i class="icon-thumbs-up"></i> Go back to task</a>
            </div>
        </div>
    </div>
</div>





<header class="site-header clearfix">
    <div>
        <div id="success" class="alert alert-success" style="display:none">
            <h2><strong>Well done!</strong> Your answer has been saved</h2>
        </div>
        <div id="loading" class="alert alert-info" style="display:none">
           <h2> Loading next task...</h2>
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none">
            <h2><strong>The task has been completed!</strong> Thanks a lot!</h2>
        </div>
        <div id="finish" class="alert alert-success" style="display:none">
            <h2><strong>Congratulations!</strong> You have participated in all available tasks!</h2>
            <p></p>
            <div class="alert-actions">
                <a class="btn small" href="http://citscitools.cancerresearchuk.org/community/about/">Find out more here</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none">
            <h2><strong>Error!</strong> Something went wrong, please contact the site administrators</h2>
        </div>
    </div>
</header>

<main class="site-content clearfix">
    <div class="row clearfix">

        <!--Left hand side-->
        <div class="span6">
            <div id="grid-info" class="grid-info">

                <div class="grid-info-instructions">
                    <h1 id="question">Select which grid sections contain cancer cells</h1>

                    <p>
                        If you see cancer cells:
                        <br/> Click once for <span class="text-error">yes</span>
                        <br/> Double click for <span class="text-success">no</span>
                    </p>
                </div>

                <!--<select class="grid-info-difficulty" id="difficulty">-->
                <!--<option value="0" selected>Please select an image difficulty level:</option>-->
                <!--<option value="1">1 - Very easy</option>-->
                <!--<option value="2">2 - Easy</option>-->
                <!--<option value="3">3 - Average</option>-->
                <!--<option value="4">4 - Difficult</option>-->
                <!--<option value="5">5 - Very difficult</option>-->
                <!--</select>-->

                <div class="grid-info-buttons">
                    <button class="btn" id="selectAllBtn" value="all">Select All</button>
                    <button class="btn" id="deselectBtn">Deselect All</button>

                    <button class="btn btn-primary" id="modalBtn">Tutorial</button>
                    <button class="btn btn-answer btn-success nextSlideBtn" id="nextSlideBtn" value="next">Next slide</button>
                </div>

                <div class="progress progress-striped">
                    <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <!--Right hand side-->
        <div class="span6 wrapper grid-wrapper" id="grid-wrapper">
            <a id="photo-link"></a>

            <div class="canvas" id="canvas"></div>
        </div>
    </div>
</main>

<div class="row example-list clearfix">
    <h2>Cell Examples</h2>
    <figure class="example-list-item">
        <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/legend/cancer-cells.jpg" alt=""/>
        <figcaption class="description">Cancer Cells</figcaption>
    </figure>
    <figure class="example-list-item">
        <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/legend/cancer-cells2.jpg" alt=""/>
        <figcaption class="description">Cancer Cells</figcaption>
    </figure>
    <figure class="example-list-item">
        <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/legend/healthy-cells.jpg" alt=""/>
        <figcaption class="description">Healthy cells</figcaption>
    </figure>

    <figure class="example-list-item">
        <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/legend/blood-cells.jpg" alt=""/>
        <figcaption class="description">Blood cells</figcaption>
    </figure>
    <figure class="example-list-item">
        <img src="//citscitools.cancerresearchuk.org/static/img/mvp-01/legend/stroma-and-blood-cells.jpg" alt=""/>
        <figcaption class="description">Stroma and blood cells</figcaption>
    </figure>
</div>

<script type="text/javascript" async="async">

    "use strict";

    /**
     * grid.js
     * Grid Constructor function
     * Its a bit of a miss match of vanilla JS and jQuery...sorry,
     * wanted to do everything in JS but for speed i did jQuery
     *
     */
    function Grid(task) {

        //Modal.call(this);

        this.task = task;
        this.activateCell();

        /**
         *
         * Initializing the elevateZoom library
         * www.elevateweb.co.uk/image-zoom
         *
         */
        $(".img-polaroid").elevateZoom({
            zoomWindowPosition: "grid-info",
            lensFadeIn: 500,
            lensFadeOut: 500,
            // Changing these two numbers changes the zoomWindowWidth
            // Also the side of the .zoomLens (box over image)
            zoomWindowWidth: 455,
            zoomWindowHeight: 455,
        });
    }

    //Grid.prototype = Object.create(Modal.prototype);

    /**
     *
     * For creating a grid overlayed over the image
     *
     */
    Grid.prototype.createGrid = function () {

        /*
         * Using raphael so we can use methods like isPointInside
         * and calculate how close the click on grid are.
         * Also nice and cross browser :D
         *
         * Maybe d3 might have been better!?
         */
        var rows = 6,
            columns = 6,
            canvas = Raphael("canvas", $(".img-polaroid").width(), $(".img-polaroid").height()),
            gridHeight = $(".img-polaroid").height() / columns,
            gridWidth = $(".img-polaroid").width() / rows;

        // creates 36 grid squares in raphael
        var x, y;
        for (y = 0; y < rows; y += 1) {
            for (x = 0; x < columns; x += 1) {

                var offsetH = y,
                    offsetW = x,
                    moveDown = (y + gridHeight - offsetH) * y,
                    moveRight = (x + gridWidth - offsetW) * x,
                    gridSquare = canvas.rect(moveRight, moveDown, gridWidth, gridHeight).attr({
                        "stroke": "#fff"
                    });

                gridSquare.node.setAttribute("class", "grid-item");

                gridSquare.column = x;
                gridSquare.row = y;
                gridSquare.has_cancer = null;

                // Save all grid squares in array within main task object
                // We can then grab this when saving the info at the end
                this.task.answer.squares.push(gridSquare);

            }
        }
    };


    /**
     *
     * Listen for lick on .zoomLens and find the closed square
     *
     */
    Grid.prototype.activateCell = function () {

        var clicks = 0;
        var timer = null;
        var _this = this;

        $("body").on("click touchstart", ".zoomLens", function (evt) {

            evt.preventDefault();
            clicks++; //count clicks

            // Find the cloest grid square to click on the zoomLens

            var activeSquare = _this.findClosestSquare();
            var activeSquareNode = activeSquare.node;

            // Not able to use jQuery .click or .dblclick for some reason i can't remember
            // If we can then should use jQuery...might be quicker and easier

            if (clicks === 1) {
                timer = setTimeout(function () {
                    // Adds and removes classes to grid squares making them red or green
                    if (activeSquareNode.className.animVal != "grid-item grid-item-success") {
                        activeSquareNode.setAttribute("class", "grid-item grid-item-success");
                        activeSquare.has_cancer = true;
                    } else {
                        activeSquareNode.setAttribute("class", "grid-item");
                        activeSquare.has_cancer = null;
                    } //after action performed, reset counter
                    clicks = 0;
                }, 250);
            } else {
                clearTimeout(timer); //prevent single-click action
                activeSquareNode.setAttribute("class", "grid-item grid-item-error");
                activeSquare.has_cancer = false;
                clicks = 0;
            }
        });
    };

    /**
     *
     * Loop through the grid items
     * and find the closest matching grid
     * that have the clicked coordinates
     *
     */
    Grid.prototype.findClosestSquare = function () {

        var _this = this,
            activeSquare,
            target = $(".zoomLens"),
            target_pos = {
                x: parseInt(target.css("left")),
                y: parseInt(target.css("top"))
            };

        // Center the zoom cursor to middle of square
        target_pos.x = target_pos.x + 34.85;
        target_pos.y = target_pos.y + 34.85;

        // Find the closet grid item
        $.each(_this.task.answer.squares, function (key, value) {
            if (value.isPointInside(target_pos.x, target_pos.y)) {
                activeSquare = value;
            }
        });
        return activeSquare;
    };


    Grid.prototype.selectAllSquares = function () {
        for (var i = 0; i < this.task.answer.squares.length; i++) {
            var gridSquare = this.task.answer.squares[i],
                gridSquareNode = this.task.answer.squares[i].node;
            gridSquare.has_cancer = true;
            gridSquareNode.setAttribute("class", "grid-item grid-item-success");
        }
    }
    Grid.prototype.deselectAllSquares = function () {
        for (var i = 0; i < this.task.answer.squares.length; i++) {
            var gridSquare = this.task.answer.squares[i],
                gridSquareNode = this.task.answer.squares[i].node;
            gridSquare.has_cancer = null;
            gridSquareNode.setAttribute("class", "grid-item");
        }
    }


    /*
     *
     * End of Grid class
     *
     * */









    /*
     *
     * Helpful functions
     *
     *
     */

    // Loads user progress into Grid info
    function loadUserProgress() {
        pybossa.userProgress('mvp-02b').done(function (data) {
            var pct = Math.round((data.done * 100) / data.total);
            $("#progress").css("width", pct.toString() + "%");
            $("#progress").attr("title", pct.toString() + "% completed!");
            $("#progress").tooltip({
                'placement': 'bottom'
            });
            $("#total").text(data.total);
            $("#done").text(data.done);
        });
    }

    // uses device.js and works out what device we are using
    function whatDevice() {
        var desktop = device.desktop(),
            mobile = device.mobile(),
            tablet = device.tablet(),
            portrait = device.portrait(),
            landscape = device.landscape(),
            iphone = device.iphone(),
            android = device.android(),
            androidTablet = device.androidTablet(),
            blackberryTablet = device.blackberryTablet();


        if (desktop) return "Desktop";
        if (mobile && portrait)    return "Mobile portrait";
        if (mobile && portrait)    return "Mobile landscape";
        if (tablet && portrait)    return "Tablet portrait";
        if (tablet && landscape)    return "Tablet landscape";
    }

    // Using useragent we find what browser we are using
    function whatBrowser() {
        var ua = navigator.userAgent, tem,
            M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
        if (/trident/i.test(M[1])) {
            tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
            return 'IE ' + (tem[1] || '');
        }
        if (M[1] === 'Chrome') {
            tem = ua.match(/\bOPR\/(\d+)/);
            if (tem != null) return 'Opera ' + tem[1];
        }
        M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
        if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
        return M.join(' ');
    }


    /*
     *
     * PyBossa stuff
     * - .taskLoaded
     * - .presentTask
     *      - .saveTask
     *
     */

    pybossa.taskLoaded(function (task, deferred) {

        if (!$.isEmptyObject(task)) {
            // load image from flickr
            var img = $('<img />');
            img.load(function () {
                // continue as soon as the image is loaded
                deferred.resolve(task);
            });

            img.attr('src', task.info.url_b).css('height', 460);
            img.attr('data-zoom-image', task.info.url_b);
            img.addClass('img-polaroid');
            task.info.image = img;


            task.answer = {
                squares: [],
                timeTaken: "",
                device: "",
                browser: "",
                img: "",
                openModalCount: 0
            }

        } else {
            deferred.resolve(task);
        }
    });

    pybossa.presentTask(function (task, deferred) {

        if (!$.isEmptyObject(task)) {

            loadUserProgress();


            /*
             * Take a time stamp of the time the page loads
             */
            var oldTime = new Date();

            $('#photo-link').html('').append(task.info.image);
            $("#question").html(task.info.question);
            $('#task-id').html(task.id);

            /*
             * Init my Grid Constructor
             */

            var r = new Grid(task);
            r.createGrid();

            var selectBtn = document.getElementById("selectAllBtn");
            selectBtn.onclick = function () {
                r.selectAllSquares();
            }
            var deselectBtn = document.getElementById("deselectBtn");
            deselectBtn.onclick = function () {
                r.deselectAllSquares();
            }

            //Launch tutorial modal
            var openModalCount = 0;
            var modalBtn = document.getElementById("modalBtn");
            modalBtn.onclick = function () {
                $("#modal").modal('show');
                $('.carousel').carousel({
                    interval: false
                });
                openModalCount++;
            };



            // On click of the "next slide" button
            $('.btn-answer').off('click').on('click', function () {



                    // Grab a new timestamp and find out the difference
                    // This is how long the user has been on the task for
                    // Then pass it into the answer
                    var newTime = new Date(),
                        ms = newTime - oldTime,
                        x = ms / 1000,
                        seconds = (((x % 31536000) % 86400) % 3600) % 60;

                    // Pass image number into answer
                    var imgUrl = task.info.url_b;
                    var result = imgUrl.replace("//citscitools.cancerresearchuk.org/static/img/mvp-01/", "");

                    // Create the answer object
                    var answer = {
                        squares: [],
                        timeTaken: seconds,
                        device: whatDevice(),
                        browser: whatBrowser(),
                        imgNumber: result,
                        openModalCount: openModalCount
                    };


                    // Change the square object to have clearer values
                    $.each(r.task.answer.squares, function (key, value) {
                        var obj = {
                            column: value.column,
                            row: value.row,
                            answer: value.has_cancer
                        };
                        answer.squares.push(obj);
                    });

                    console.log(answer);

                    /*
                     * Save the task information and send to PyBossa
                     */
                    pybossa.saveTask(task.id, answer).done(function (data) {
                        $("#success").fadeIn(500).delay(500).fadeOut();
                        $("svg, .zoomContainer,.zoomWindowContainer").remove();
                        deferred.resolve();
                    });

                //$("#loading").fadeIn(500).delay(500).fadeOut();

            });


        } else {

            $("#loading").hide();
            $("#finish").fadeIn(500);
            $(".span6").fadeTo( "slow" , 0.5);
        }
    });


    /**
     *
     * app.js
     * General app stuff like inits and buttons listeners
     *
     */

    $(function () {
        pybossa.run('mvp-02b');
    })


    /*
     * Modal
     *
     */

    var step = -1;
    function showStep(action) {
        $("#" + step).hide();

        if (action == 'next') {
            step += 1;
        }
        if (action == 'prev') {
            step -= 1;
        }


         if (step == 0) {
            $("#prevBtn").hide();
            $(".modal-info .item-content-inner").remove();
        } else {
            $("#prevBtn").show();
        }

        if (step == 0 || step == 6 || step == 7 || step == 8 || step == 9 || step == 10 || step == 11 || step == 12 || step == 13 || step == 14 || step == 15 || step == 16 || step == 17 || step == 18 || step == 19) {
            $(".modal-body").addClass("has-info");
        } else {
            $(".modal-body").removeClass("has-info");
        }

        if (step == 10) {
            $("#nextBtn").hide();
            $("#goBackBtn").show();
        } else {
            $("#nextBtn").show();
            $("#goBackBtn").hide();
        }
        $("#" + step).show();


    }

    showStep('next');
    var openModalCount = 0;

    //Launch tutoiral modal
    var modalBtn = document.getElementById("modalBtn");
    modalBtn.onclick = function () {

        $("#modal").modal('show');
        $('.carousel').carousel();
    };

    var nextBtn = document.getElementById("nextBtn");
    nextBtn.onclick = function () {
        showStep('next');
    };
    var prevBtn = document.getElementById("prevBtn");
    prevBtn.onclick = function () {
        showStep('prev');
    };







//    var csrftoken = "{{ csrf_token() }}";

//    $.ajaxSetup({
//        beforeSend: function (xhr, settings) {
//            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
//                xhr.setRequestHeader("X-CSRFToken", csrftoken);
//            }
//        }
//    });

</script>



